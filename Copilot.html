<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dungeon Game</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/17.0.2/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/17.0.2/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.26.0/babel.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<style>
body {
background-color: black;
}
.wall {
width: 100%;
height: 100%;
object-fit: cover;
}
.floor {
width: 100%;
height: 100%;
object-fit: cover;
}
.stair {
position: absolute;
width: 100%;
height: 100%;
object-fit: cover;
z-index: 10;
}
.counter {
position: absolute;
top: 10px;
right: 10px;
color: white;
font-size: 24px;
font-weight: bold;
z-index: 10;
}
.player-sprite {
position: absolute;
width: 100%;
height: 100%;
transition: background-image 0.5s ease-in-out;
}
.menu {
position: absolute;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
background-color: rgba(0, 0, 0, 0.8);
border: 2px solid white;
border-radius: 8px;
padding: 20px;
z-index: 20;
}
.menu button {
margin: 5px;
}
.options-menu {
display: flex;
flex-direction: column;
}
.options-menu label {
color: white;
}
.moves-menu {
display: flex;
flex-direction: column;
}
.moves-menu p {
color: white;
}
.red-border {
border: 2px solid transparent;
border-image: linear-gradient(to right, red, transparent) 1;
}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
// Utility to index inventory items with their definitions and positions
const getInventoryIndex = (inventory, ITEM_DEFS) => {
  return inventory.map((item, position) => ({
    item,
    itemDef: ITEM_DEFS[item.name],
    position
  }));
};

//import { frames } from 'frameExports.js'
//console.log (frames.characters.vaporeon.idle.down.frame1);
const Reviverseed = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Item%20Sprites/Seed_Yellow.png';
const MOVE_DEFS = {
  "Acid Armor": {
    name: "Acid Armor",
    type: "Poison",
    power: 0,
    accuracy: 100,
    ppmax: 30,
    ppcurr: 30,
    effect: "Raises user's Defense by 2 stages.",
  },
  "Aqua Tail": {
    name: "Aqua Tail",
    type: "Water",
    power: 90,
    accuracy: 90,
    ppmax: 10,
    ppcurr: 10,
    effect: "Has a high critical hit ratio.",
  },
  "Aurora Beam": {
    name: "Aurora Beam",
    type: "Ice",
    power: 65,
    accuracy: 100,
    pp: 20,
    effect: "May lower the target's Attack by 1 stage.",
  },
  "Bite": {
    name: "Bite",
    type: "Dark",
    power: 60,
    accuracy: 100,
    pp: 25,
    effect: "May cause the target to flinch.",
  },
  "Bubble Beam": {
    name: "Bubble Beam",
    type: "Water",
    power: 65,
    accuracy: 100,
    pp: 20,
    effect: "May lower the target's Speed by 1 stage.",
  },
  "Hydro Pump": {
    name: "Hydro Pump",
    type: "Water",
    power: 110,
    accuracy: 80,
    pp: 5,
    effect: "No additional effect.",
  },
  "Ice Beam": {
    name: "Ice Beam",
    type: "Ice",
    power: 90,
    accuracy: 100,
    pp: 10,
    effect: "May freeze."
  },
  "Muddy Water": {
    name: "Muddy Water",
    type: "Water",
    power: 90,
    accuracy: 85,
    pp: 10,
    effect: "May lower the target's accuracy by 1 stage.",
  },
  'Refresh': {
    name: 'Refresh',
    type: 'Normal',
    power: 0,
    accuracy: 100,
    ppmax: 20,
    ppcurr: 20,
    effect: "Heals the user if it is poisoned, burned, or paralyzed.",
  },
  "Water Pulse": {
    name: "Water Pulse",
    type: "Water",
    power: 60,
    accuracy: 100,
    ppmax: 20,
    ppcurr: 20,
    effect: "May confuse the target.",
  }
};
const ITEM_DEFS = {
  "Reviver Seed": {
    name: "Reviver Seed",
    sprite: Reviverseed,
    stackSize: 1
  },
  "Stun Seed": {
    name: "Stun Seed",
    sprite: Reviverseed,
    stackSize: 1
  },
  "Tiny Reviver Seed": {
    name: "Tiny Reviver Seed",
    sprite: Reviverseed,
    stackSize: 1
  },
  "Sleep Seed": {
    name: "Sleep Seed",
    sprite: Reviverseed,
    stackSize: 1
  }
  ,"Warp Seed": {
    name: "Warp Seed",
    sprite: Reviverseed,
    stackSize: 1
  },
  "Life Seed": {
    name: "Life Seed",
    sprite: Reviverseed,
    stackSize: 1
  }
};
const MAX_INVENTORY_SLOTS = 10;

const vaporeonSprites = [
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/idle/IdleanimD1.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/idle/IdleanimD2.png'
];

const vaporeonLeftSprites = [
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/idle/IdleanimL1.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/idle/IdleanimL2.png'
];

const vaporeonRightSprites = [
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/idle/IdleanimR1.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/idle/IdleanimR2.png'
];

const vaporeonUpSprites = [
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/idle/IdleanimU1.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/idle/IdleanimU2.png'
];

const vaporeonDownLeftSprites = [
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/idle/IdleanimBL1.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/idle/IdleanimBL2.png'
];

const vaporeonDownRightSprites = [
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/idle/IdleanimBR1.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/idle/IdleanimBR2.png'
];

const vaporeonUpLeftSprites = [
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/idle/IdleanimTL1.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/idle/IdleanimTL2.png'
];

const vaporeonUpRightSprites = [
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/idle/IdleanimTR1.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/idle/IdleanimTR2.png'
];

const vaporeonDownWalkSprites = [
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/walk/WalkanimD1Padded.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/walk/WalkanimD2Padded.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/walk/WalkanimD3Padded.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/walk/WalkanimD4Padded.png'
]

const vaporeonUpWalkSprites = [
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/walk/WalkanimU1Padded.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/walk/WalkanimU2Padded.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/walk/WalkanimU3Padded.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/walk/WalkanimU4Padded.png'
]

const vaporeonLeftWalkSprites = [
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/walk/WalkanimL1Padded.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/walk/WalkanimL2Padded.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/walk/WalkanimL3Padded.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/walk/WalkanimL4Padded.png'
]

const vaporeonRightWalkSprites = [
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/walk/WalkanimR1Padded.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/walk/WalkanimR2Padded.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/walk/WalkanimR3Padded.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/walk/WalkanimR4Padded.png'
]

const vaporeonUpLeftWalkSprites = [
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/walk/WalkanimTL1Padded.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/walk/WalkanimTL2Padded.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/walk/WalkanimTL3Padded.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/walk/WalkanimTL4Padded.png'
]

const vaporeonUpRightWalkSprites = [
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/walk/WalkanimTR1Padded.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/walk/WalkanimTR2Padded.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/walk/WalkanimTR3Padded.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/walk/WalkanimTR4Padded.png'
]

const vaporeonDownLeftWalkSprites = [
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/walk/WalkanimBL1Padded.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/walk/WalkanimBL2Padded.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/walk/WalkanimBL3Padded.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/walk/WalkanimBL4Padded.png'
]

const vaporeonDownRightWalkSprites = [
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/walk/WalkanimBR1Padded.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/walk/WalkanimBR2Padded.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/walk/WalkanimBR3Padded.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/walk/WalkanimBR4Padded.png',

]
const vaporeonUpSpinSprites = [
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonUpSpinFrame1.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonUpSpinFrame2.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonUpSpinFrame3.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonUpSpinFrame4.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonUpSpinFrame5.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonUpSpinFrame6.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonUpSpinFrame7.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonUpSpinFrame8.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonUpSpinFrame9.png'
]
const vaporeonUpRightSpinSprites = [
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonUpRightSpinFrame1.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonUpRightSpinFrame2.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonUpRightSpinFrame3.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonUpRightSpinFrame4.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonUpRightSpinFrame5.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonUpRightSpinFrame6.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonUpRightSpinFrame7.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonUpRightSpinFrame8.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonUpRightSpinFrame9.png'
]
const vaporeonRightSpinSprites = [
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonRightSpinFrame1.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonRightSpinFrame2.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonRightSpinFrame3.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonRightSpinFrame4.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonRightSpinFrame5.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonRightSpinFrame6.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonRightSpinFrame7.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonRightSpinFrame8.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonRightSpinFrame9.png'
]
const vaporeonDownRightSpinSprites = [
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonDownRightSpinFrame1.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonDownRightSpinFrame2.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonDownRightSpinFrame3.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonDownRightSpinFrame4.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonDownRightSpinFrame5.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonDownRightSpinFrame6.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonDownRightSpinFrame7.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonDownRightSpinFrame8.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonDownRightSpinFrame9.png'
]
const vaporeonDownSpinSprites = [
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonDownSpinFrame1.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonDownSpinFrame2.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonDownSpinFrame3.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonDownSpinFrame4.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonDownSpinFrame5.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonDownSpinFrame6.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonDownSpinFrame7.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonDownSpinFrame8.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonDownSpinFrame9.png'
]
const vaporeonDownLeftSpinSprites = [
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonDownLeftSpinFrame1.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/%20VaporeonDownLeftSpinFrame2.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/%20VaporeonDownLeftSpinFrame3.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonDownLeftSpinFrame4.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonDownLeftSpinFrame5.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonDownLeftSpinFrame6.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonDownLeftSpinFrame7.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonDownLeftSpinFrame8.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonDownLeftSpinFrame9.png'
]
const vaporeonLeftSpinSprites = [
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonLeftSpinFrame1.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonLeftSpinFrame2.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonLeftSpinFrame3.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonLeftSpinFrame4.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonLeftSpinFrame5.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonLeftSpinFrame6.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonLeftSpinFrame7.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonLeftSpinFrame8.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonLeftSpinFrame9.png'
]
const vaporeonUpLeftSpinSprites = [
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonUpLeftSpinFrame1.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonUpLeftSpinFrame2.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonUpLeftSpinFrame3.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonUpLeftSpinFrame4.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonUpLeftSpinFrame5.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonUpLeftSpinFrame6.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonUpLeftSpinFrame7.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonUpLeftSpinFrame8.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/spin/VaporeonUpLeftSpinFrame9.png'
]
const vaporeonSleepSprites = [
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/sleep/sleepAnim1.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/sleep/sleepAnim2.png'
]
const levelVfxFrames = [
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/level/levelFrame1.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/level/levelFrame2.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/level/levelFrame3.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/level/levelFrame4.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/level/levelFrame5.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/level/levelFrame6.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/level/levelFrame7.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/level/levelFrame8.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/level/levelFrame9.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/level/levelFrame10.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/level/levelFrame11.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/level/levelFrame12.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/level/levelFrame13.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/level/levelFrame14.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/level/levelFrame15.png'
]
const buffVfxFrames = [
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/buff/buffFrame1.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/buff/buffFrame2.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/buff/buffFrame3.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/buff/buffFrame4.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/buff/buffFrame5.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/buff/buffFrame6.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/buff/buffFrame7.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/buff/buffFrame8.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/buff/buffFrame9.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/buff/buffFrame10.png',
  'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/animations/frames/buff/buffFrame11.png'
]
const vaporeonPortraitNormal = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Pokemon%20Sprites/Vaporeon/portraits/VaporeonPortrait_Normal.png';

const Pokedollar = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Item%20Sprites/Pokedollar.png'; // Replace with your sprite URL

const wallSpriteLeft = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Tiles/Area1/EditedwallSpritesheet164l.png';
const wallSpriteRight = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Tiles/Area1/EditedwallSpritesheet167r.png';
const wallSpriteUp = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Tiles/Area1/EditedwallSpritesheet001u.png';
const wallSpriteDown = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Tiles/Area1/EditedwallSpritesheet186d.png';
const cornerSpriteTopLeft = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Tiles/Area1/EditedwallSpritesheet000tl.png'; // Updated to new top left corner sprite
const cornerSpriteTopRight = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Tiles/Area1/EditedwallSpritesheet003tr.png'; // Updated to new top right corner sprite
const cornerSpriteBottomLeft = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Tiles/Area1/EditedwallSpritesheet124bl.png'; // Updated to new bottom left corner sprite
const cornerSpriteBottomRight = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Tiles/Area1/EditedwallSpritesheet159br.png';
const enclosedWallSprite1 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Tiles/Area1/Brick%20Wall%20Full1.png';
const enclosedWallSprite2 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Tiles/Area1/Brick%20Wall%20Full2.png';
const enclosedWallSprite3 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Tiles/Area1/Brick%20Wall%20Full3.png';
const enclosedWallSprite4 ='https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Tiles/Area1/Brick%20Wall%20Full4.png';
const innerCornerTopRight = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Tiles/Area1/Brick_Wall_inner_corner_topright.png';
const innerCornerTopLeft = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Tiles/Area1/Brick_Wall_inner_corner_topleft.png';
const innerCornerBottomRight = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Tiles/Area1/Brick_Wall_inner_corner_bottomright.png';
const innerCornerBottomLeft = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Tiles/Area1/Brick_Wall_inner_corner_bottomleft.png';
//These are debug images to test the exp bar
const expBarComponent100 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar100%25.png';
const expBarComponent0 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar0%25.png';
const expBarComponent1 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar1%25.png';
const expBarComponent2 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar2%25.png';
const expBarComponent3 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar3%25.png';
const expBarComponent4 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar4%25.png';
const expBarComponent5 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar5%25.png';
const expBarComponent6 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar6%25.png';
const expBarComponent7 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar7%25.png';
const expBarComponent8 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar8%25.png';
const expBarComponent9 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar9%25.png';
const expBarComponent10 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar10%25.png';
const expBarComponent11 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar11%25.png';
const expBarComponent12 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar12%25.png';
const expBarComponent13 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar13%25.png';
const expBarComponent14 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar14%25.png';
const expBarComponent15 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar15%25.png';
const expBarComponent16 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar16%25.png';
const expBarComponent17 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar17%25.png';
const expBarComponent18 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar18%25.png';
const expBarComponent19 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar19%25.png';
const expBarComponent20 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar20%25.png';
const expBarComponent21 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar21%25.png';
const expBarComponent22 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar22%25.png';
const expBarComponent23 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar23%25.png';
const expBarComponent24 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar24%25.png';
const expBarComponent25 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar25%25.png';
const expBarComponent26 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar26%25.png';
const expBarComponent27 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar27%25.png';
const expBarComponent28 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar28%25.png';
const expBarComponent29 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar29%25.png';
const expBarComponent30 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar30%25.png';
const expBarComponent31 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar31%25.png';
const expBarComponent32 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar32%25.png';
const expBarComponent33 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar33%25.png';
const expBarComponent34 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar34%25.png';
const expBarComponent35 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar35%25.png';
const expBarComponent36 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar36%25.png';
const expBarComponent37 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar37%25.png';
const expBarComponent38 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar38%25.png';
const expBarComponent39 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar39%25.png';
const expBarComponent40 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar40%25.png';
const expBarComponent41 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar41%25.png';
const expBarComponent42 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar42%25.png';
const expBarComponent43 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar43%25.png';
const expBarComponent44 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar44%25.png';
const expBarComponent45 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar45%25.png';
const expBarComponent46 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar46%25.png';
const expBarComponent47 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar47%25.png';
const expBarComponent48 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar48%25.png';
const expBarComponent49 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar49%25.png';
const expBarComponent50 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar50%25.png';
const expBarComponent51 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar51%25.png';
const expBarComponent52 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar52%25.png';
const expBarComponent53 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar53%25.png';
const expBarComponent54 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar54%25.png';
const expBarComponent55 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar55%25.png';
const expBarComponent56 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar56%25.png';
const expBarComponent57 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar57%25.png';
const expBarComponent58 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar58%25.png';
const expBarComponent59 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar59%25.png';
const expBarComponent60 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar60%25.png';
const expBarComponent61 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar61%25.png';
const expBarComponent62 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar62%25.png';
const expBarComponent63 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar63%25.png';
const expBarComponent64 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar64%25.png';
const expBarComponent65 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar65%25.png';
const expBarComponent66 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar66%25.png';
const expBarComponent67 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar67%25.png';
const expBarComponent68 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar68%25.png';
const expBarComponent69 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar69%25.png';
const expBarComponent70 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar70%25.png';
const expBarComponent71 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar71%25.png';
const expBarComponent72 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar72%25.png';
const expBarComponent73 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar73%25.png';
const expBarComponent74 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar74%25.png';
const expBarComponent75 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar75%25.png';
const expBarComponent76 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar76%25.png';
const expBarComponent77 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar77%25.png';
const expBarComponent78 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar78%25.png';
const expBarComponent79 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar79%25.png';
const expBarComponent80 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar80%25.png';
const expBarComponent81 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar81%25.png';
const expBarComponent82 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar82%25.png';
const expBarComponent83 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar83%25.png';
const expBarComponent84 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar84%25.png';
const expBarComponent85 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar85%25.png';
const expBarComponent86 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar86%25.png';
const expBarComponent87 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar87%25.png';
const expBarComponent88 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar88%25.png';
const expBarComponent89 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar89%25.png';
const expBarComponent90 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar90%25.png';
const expBarComponent91 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar91%25.png';
const expBarComponent92 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar92%25.png';
const expBarComponent93 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar93%25.png';
const expBarComponent94 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar94%25.png';
const expBarComponent95 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar95%25.png';
const expBarComponent96 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar96%25.png';
const expBarComponent97 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar97%25.png';
const expBarComponent98 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar98%25.png';
const expBarComponent99 = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/expBar99%25.png';
//These are debug images to test the exp bar
const itemSelector = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/itemSelector.png'
const floorSprites = [
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Tiles/Area1/EditedfloorSpritesheet068%231.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Tiles/Area1/EditedfloorSpritesheet070%232.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Tiles/Area1/EditedfloorSpritesheet116%233.png',
'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/Tiles/Area1/EditedfloorSpritesheet117%234.png'
];
const stairSprite = 'https://raw.githubusercontent.com/jm9698/Misc-SmartTool-Projects/refs/heads/main/Game%20assets/General%20sprites/StairsWithTile.png';
const Game = () => {
const [dungeon, setDungeon] = React.useState([]);
const [timeElapsed, setTimeElapsed] = React.useState(0);
const [level, setLevel] = React.useState(1);
const [playerHP, setPlayerHP] = React.useState(100);
const [maxPlayerHP, setMaxPlayerHP] = React.useState(100);
const [playerAttack, setPlayerAttack] = React.useState(10);
const [playerSpecialAttack, setPlayerSpecialAttack] = React.useState(20);
const [playerDefense, setPlayerDefense] = React.useState(5);
const [playerSpecialDefense, setPlayerSpecialDefense] = React.useState(10);
const [playerSpeed, setPlayerSpeed] = React.useState(5);
const [exp, setExp] = React.useState(0);
const [maxExp, setMaxExp] = React.useState(100);
const [currencyTiles, setCurrencyTiles] = React.useState([]);
const [currency, setCurrency] = React.useState(0);
const [itemTiles, setItemTiles] = React.useState([]);
const [itemTilesIndex, setItemTilesIndex] = React.useState([]); // Index for cycling through item tiles
const [itemTilesIndexRef, setItemTilesIndexRef] = React.useState([]);
const [natItemOrder, setNatItemOrder] = React.useState(0); // Natural item order for cycling through items
const [itemOrder, setItemOrder] = React.useState(0);
const [itemSelectedCurrent, setItemSelectedCurrent] = React.useState(null);
const [itemSelected, setItemSelected] = React.useState(null); // Index of selected item in inventory
const [showItemActionMenu, setShowItemActionMenu] = React.useState(false);
const [showMoveSelector, setShowMoveSelector] = React.useState(false);
const [selectedMove, setSelectedMove] = React.useState(0);

const moves = [
  { name: "Water Pulse", pp: `${MOVE_DEFS["Water Pulse"].ppcurr}/${MOVE_DEFS["Water Pulse"].ppmax}` },
  { name: "Aqua Tail", pp: `${MOVE_DEFS["Aqua Tail"].ppcurr}/${MOVE_DEFS["Aqua Tail"].ppmax}` },
  { name: "Acid Armor", pp: `${MOVE_DEFS["Acid Armor"].ppcurr}/${MOVE_DEFS["Acid Armor"].ppmax}` },
  { name: "Refresh", pp: `${MOVE_DEFS["Refresh"].ppcurr}/${MOVE_DEFS["Refresh"].ppmax}` }
];
const [itemActionIndex, setItemActionIndex] = React.useState(0);
const itemActions = ["Use", "Throw", "Discard"];
const [inventoryIndex, setInventoryIndex] = React.useState([]); // Index for navigating inventory
const [flickerFrame, setFlickerFrame] = React.useState(0);
const [inventory, setInventory] = React.useState([]);
const [inventoryFull, setInventoryFull] = React.useState(false);
const [showToolbox, setShowToolbox] = React.useState(false);
const [checkBox1, setCheckBox1] = React.useState(false);
const [checkBox2, setCheckBox2] = React.useState(false);
const [checkBox3, setCheckBox3] = React.useState(false);
const [actionLog, setActionLog] = React.useState([]); // [{msg, id}]
const [isAiming, setIsAiming] = React.useState(false); // Track whether player is aiming
const [inDiagonalMode, setInDiagonalMode] = React.useState(false); // Track whether player is using diagonal mode
const [showIndicators, setShowIndicators] = React.useState(false); // State to track indicator visibility
const [isWalking, setIsWalking] = React.useState(false);
const [isSleeping, setIsSleeping] = React.useState(false);
const [playerPos, setPlayerPos] = React.useState({ x: 15, y: 15 });
const [roomsState, setRoomsState] = React.useState([]); // rooms returned from generator
const [exploredTiles, setExploredTiles] = React.useState(() => new Set()); // "x,y" keys
const minimapCanvasRef = React.useRef(null);
const MINIMAP_SIZE = 200; // px (adjust as desired)

// helper for keys
const tileKey = (x, y) => `${x},${y}`;

const minHeight = 60;
const maxHeight = 70;
const minWidth = 60;
const maxWidth = 70;
const getInventoryIndex = (inventory, ITEM_DEFS) => {
  return inventory.map((item, position) => ({
    item,
    itemDef: ITEM_DEFS[item.name],
    position
  }));
};
const height = randInt(minHeight, maxHeight + 1);
const width = randInt(minWidth, maxWidth + 1);
const [stairs, setStairs] = React.useState({ x: 0, y: 0 });
const [floor, setFloor] = React.useState(1);
const [zoomLevel, setZoomLevel] = React.useState(1);
const [cameraTransform, setCameraTransform] = React.useState('');
// Use a DOM ref for the dungeon element so the camera transform can be applied
// directly to the element (avoids frequent React state updates that cause jank).
const dungeonRef = React.useRef(null);
const cameraTargetRef = React.useRef({ x: playerPos.x, y: playerPos.y });
const cameraPosRef = React.useRef({ x: playerPos.x, y: playerPos.y });
const cameraRafRef = React.useRef(null);
const [idleSpriteIndex, setIdleSpriteIndex] = React.useState(0); // Index for idle animation
const [walkSpriteIndex, setWalkSpriteIndex] = React.useState(0); // Index for walk animation
const [spinSpriteIndex, setSpinSpriteIndex] = React.useState(0); // Index for spin animation
const [sleepSpriteIndex, setSleepSpriteIndex] = React.useState(0); // Index for sleep animation
const [levelVfxIndex, setLevelVfxIndex] = React.useState(0); // Index for level up VFX animation
const [isLevelingUp, setIsLevelingUp] = React.useState(false); // State to track if leveling up
const [isBuffing, setIsBuffing] = React.useState(false); // State to track if buffing
const [buffVfxIndex, setBuffVfxIndex] = React.useState(0); // Index for buff VFX animation
const [isSpinning, setIsSpinning] = React.useState(false); // State to track if spinning
const [lastDirection, setLastDirection] = React.useState('down'); // Default direction
const [isPaused, setIsPaused] = React.useState(false); // New paused state
const [showOptions, setShowOptions] = React.useState(false); // State for options menu
const [showStatus, setShowStatus] = React.useState(false); // State for status menu
const [showMoves, setShowMoves] = React.useState(false); // State for moves menu
const [keyState, setKeyState] = React.useState({
  w: false, a: false, s: false, d: false, q: false, e: false, z: false, c: false,
  wHeld: false, aHeld: false, sHeld: false, dHeld: false,
  shift: false, qHeld: false, eHeld: false, zHeld: false, cHeld: false
});
const lastDirectionRef = React.useRef(lastDirection);
const isPausedRef = React.useRef(isPaused);
const isWalkingRef = React.useRef(isWalking);
const [projectiles, setProjectiles] = React.useState([]); // NEW: active thrown item projectiles
const projectilesRef = React.useRef([]);
projectilesRef.current = projectiles;

function getWallTileType(x, y, dungeon) {
    // Get neighbors (W = wall)
    let up = y > 0 && dungeon[y-1][x] === 'W';
    let down = y < dungeon.length-1 && dungeon[y+1][x] === 'W';
    let left = x > 0 && dungeon[y][x-1] === 'W';
    let right = x < dungeon[0].length-1 && dungeon[y][x+1] === 'W';

    // Corners (optional, for fancy tilesets)
    let upLeft = y > 0 && x > 0 && dungeon[y-1][x-1] === 'W';
    let upRight = y > 0 && x < dungeon[0].length-1 && dungeon[y-1][x+1] === 'W';
    let downLeft = y < dungeon.length-1 && x > 0 && dungeon[y+1][x-1] === 'W';
    let downRight = y < dungeon.length-1 && x < dungeon[0].length-1 && dungeon[y+1][x+1] === 'W';
if (!up && !left && right && down) return 'wall_corner_topleft';
    if (!up && !right && left && down) return 'wall_corner_topright';
    if (!down && !left && right && up) return 'wall_corner_bottomleft';
    if (!down && !right && left && up) return 'wall_corner_bottomright';
    if (up && down && !left && !right) return 'wall_vertical';
    if (!up && !down && left && right) return 'wall_horizontal';
    if (up && !down && left && right) return 'wall_horizontal_topcap';
    if (!up && down && left && right) return 'wall_horizontal_bottomcap';
    if (up && down && !left && right) return 'wall_left_vertical'
    if (up && down && !right && left) return 'wall_right_vertical'
    if (!up && down && !right && !left) return 'wall_isolated_down'
    if (up && !down && !right && !left) return 'wall_isolated_up'
    if (!up && !down && right && !left) return 'wall_isolated_right'
    if (!up && !down && !right && left) return 'wall_isolated_left'
    if (up && down && left && right && !upLeft) return 'wall_inner_corner_topleft'
    if (up && down && left && right && !upRight) return 'wall_inner_corner_topright'
    if (up && down && left && right && !downLeft) return 'wall_inner_corner_bottomleft'
    if (up && down && left && right && !downRight) return 'wall_inner_corner_bottomright'

    // ...continue for other combinations...
   else return 'wall_full'; // fallback
}
const wallSpriteMap = {
  wall_corner_topleft: cornerSpriteTopLeft,
  wall_corner_topright: cornerSpriteTopRight,
  wall_corner_bottomleft: cornerSpriteBottomLeft,
  wall_corner_bottomright: cornerSpriteBottomRight,
  wall_vertical: wallSpriteLeft,
  wall_left_vertical: wallSpriteLeft,
  wall_right_vertical: wallSpriteRight,
  wall_horizontal: wallSpriteUp,
  wall_horizontal_topcap: wallSpriteDown,
  wall_horizontal_bottomcap: wallSpriteUp,
  wall_full: enclosedWallSprite4, //placeholder
  wall_isolated_down: wallSpriteLeft,
  wall_isolated_up: wallSpriteLeft,
  wall_isolated_right: wallSpriteUp,
  wall_isolated_left: wallSpriteUp,
  wall_inner_corner_topleft: innerCornerTopLeft,
  wall_inner_corner_topright: innerCornerTopRight,
  wall_inner_corner_bottomleft: innerCornerBottomLeft,
  wall_inner_corner_bottomright: innerCornerBottomRight
  // ...etc...
};
function updateKeyState(key, value) {
  setKeyState(prev => ({ ...prev, [key]: value }));
}
function randInt(min, max) {
  return Math.floor(Math.random() * (max - min)) + min;
}
const walkCooldownRef = React.useRef(null);
function triggerWalkCooldown() {
  // Clear any existing cooldown
  if (walkCooldownRef.current) clearTimeout(walkCooldownRef.current);
  setIsWalking(true);
  walkCooldownRef.current = setTimeout(() => {
    setIsWalking(false);
    walkCooldownRef.current = null;
  }, 1500); // 1500ms for 5 frames at 300ms/frame
}
let logCounter = 0;
function addLogMessage(msg) {
  const id = Date.now().toString() + Math.random().toString(36).substr(2, 9);
  setActionLog(logs => [...logs, { msg, id }]);
  setTimeout(() => {
    setActionLog(logs => logs.filter(entry => entry.id !== id));
  }, 10000);
}
function makeRoom(x, y, w, h) {
  return { x, y, w, h, center: { x: Math.floor(x + w / 2), y: Math.floor(y + h / 2) } };
}
function roomsOverlap(a, b) {
  const overlapBuffer = -2;
  return (
    Math.abs(a.x + overlapBuffer) < Math.abs(b.x + b.w) &&
    Math.abs(a.x + a.w) > Math.abs(b.x + overlapBuffer) &&
    Math.abs(a.y + overlapBuffer) < Math.abs(b.y + b.h) &&
    Math.abs(a.y + a.h) > Math.abs(b.y + overlapBuffer)
  );
}
function carveRoom(dungeon, room) {
  for (let y = room.y; y < room.y + room.h; y++) {
    for (let x = room.x; x < room.x + room.w; x++) {
      dungeon[y][x] = 'F'; // Mark as floor (will be replaced with random floor tile later)
    }
  }
}
function carveCorridor(dungeon, from, to) {
  let x = from.x, y = from.y;
  while (x !== to.x) {
    dungeon[y][x] = 'F';
    x += x < to.x ? 1 : -1;
  }
  while (y !== to.y) {
    dungeon[y][x] = 'F';
    y += y < to.y ? 1 : -1;
  }
}
function generateCurrencyTiles(dungeon, minAmount, maxAmount, currencyCount = 5) {
  let cLocations = [];
  let height = dungeon.length;
  let width = dungeon[0].length;

  // Collect all floor tile positions
  let floorPositions = [];
  for (let y = 0; y < height; y++) {
    for (let x = 0; x < width; x++) {
      if (dungeon[y][x] !== 'W' && dungeon[y][x] !== 'S') {
        floorPositions.push({ x, y });
      }
    }
  }

  // Shuffle and pick currencyCount locations
  for (let i = 0; i < currencyCount && floorPositions.length > 0; i++) {
    let idx = randInt(0, floorPositions.length);
    let loc = floorPositions.splice(idx, 1)[0];
    cLocations.push({
      ...loc,
      amount: randInt(minAmount, maxAmount + 1)
    });
  }

  return cLocations;
}
function generateSingleItem(position, item) {
  console.log('Generating single item:', item);
  let iLocations = [];
  const itemNames = Object.keys(ITEM_DEFS);
  const itemSprites = Object.values(ITEM_DEFS).map(def => def.sprite);
  const itemName = item.name;
  const itemSprite = itemSprites[1];
  console.log('Generating single item:', itemName, itemSprite, 'at position', position);
  iLocations.push({
      ...position,
      itemName,
      sprite: ITEM_DEFS[itemName].sprite
    });
    return iLocations;
}
function beginItemTilesIndex(itemAdded) {
  console.log('Updating item tiles index with:', itemAdded);
  setItemTilesIndex(itemAdded);
  console.log('Item Tiles Index after update:', itemTilesIndex);
}
function updateItemTilesIndex(newIndex) {
  console.log('Updating item tiles index to:', newIndex);
  setItemTilesIndex(prev => [...prev, newIndex]);
  return newIndex;
  console.log('Item Tiles Index after update:', itemTilesIndex);
}
React.useEffect(() => {
  console.log('Item Tiles Index changed:', itemTilesIndex);
  setItemTilesIndexRef(itemTilesIndex);
  console.log('Item Tiles Index Ref updated:', itemTilesIndexRef);
}, [itemTilesIndex]);
function generateItemTiles(dungeon, minCount = 5, maxCount = 10, itemCount = randInt(minCount, maxCount)) {
  let iLocations = []
  let height = dungeon.length;
  let width = dungeon[0].length;
  
  let floorPositions = [];
  for (let y = 0; y < height; y++) {
    for (let x = 0; x < width; x++) {
      if (dungeon[y][x] !== 'W' && dungeon[y][x] !== 'S') {
        floorPositions.push({ x, y });
      }
    }
  }
  const itemNames = Object.keys(ITEM_DEFS);

  for (let i = 0; i < itemCount && floorPositions.length > 0; i++) {
    let idx = randInt(0, floorPositions.length);
    let loc = floorPositions.splice(idx, 1)[0];
    let itemName = itemNames[randInt(0, itemNames.length)];
    iLocations.push({
      ...loc,
      itemName,
      sprite: ITEM_DEFS[itemName].sprite
    });
  }
  return iLocations;
}
function describeArc(cx, cy, r, startAngle, endAngle) {
  const start = polarToCartesian(cx, cy, r, endAngle);
  const end = polarToCartesian(cx, cy, r, startAngle);
  const largeArcFlag = endAngle - startAngle <= 180 ? "0" : "1";
  return [
    "M", cx, cy,
    "L", start.x, start.y,
    "A", r, r, 0, largeArcFlag, 0, end.x, end.y,
    "Z"
  ].join(" ");
}
function polarToCartesian(cx, cy, r, angle) {
  const rad = (angle - 90) * Math.PI / 180.0;
  return {
    x: cx + r * Math.cos(rad),
    y: cy + r * Math.sin(rad)
  };
}
function useMove(moveIndex) {
  const move = moves[moveIndex];
  let specialDefenceGain = 10; // TODO: Add an initial state variable for this
  let buffState = playerSpecialDefense/specialDefenceGain;
  if (!move) return;
  MOVE_DEFS[move.name].ppcurr = Math.max(0, MOVE_DEFS[move.name].ppcurr - 1);
  if (move.name === 'Acid Armor' && buffState === 1) {
    setPlayerSpecialDefense(prev => prev + specialDefenceGain);
    setIsBuffing(true);
    setTimeout(() => setIsBuffing(false), 1650);
    addLogMessage('Vaporeon used Acid Armor! Special Defense increased!');
  } else if (move.name === 'Acid Armor' && buffState < 4) {
    setPlayerSpecialDefense(prev => prev + specialDefenceGain);
    setIsBuffing(true);
    setTimeout(() => setIsBuffing(false), 1650);
    addLogMessage('Vaporeon used Acid Armor! Special Defense increased!');
  } else if (move.name === 'Acid Armor' && buffState >= 4) {
    setIsBuffing(true);
    setTimeout(() => setIsBuffing(false), 1650);
    addLogMessage('Vaporeon used Acid Armor, but her Special Defense can\'t go any higher!');
    return;
  }
}
function addItemToInventory(itemName) {
  const itemDef = ITEM_DEFS[itemName];

  // Safely update item order inside inventory update logic
  setInventory(prev => {
    let newInventory = [...prev];
    let itemSelected = newInventory.find(item => item.name === itemName);
    console.log('Adding item:', itemName)
    console.log('Inventory Index:', getInventoryIndex(newInventory, ITEM_DEFS))
    // Removed invalid itemOrder property access

    // Find stacks of this item that are not full
    let stackIndexes = [];
    newInventory.forEach((stack, idx) => {
      if (stack.name === itemName && stack.count < itemDef.stackSize) stackIndexes.push(idx);
    });

    let updatedInventory;
    // Try to add to an existing stack
    if (stackIndexes.length) {
      // There is at least one stack with space
      const updated = [...newInventory];
      updated[stackIndexes[0]].count += 1;
      updatedInventory = updated;
      // Do NOT increment item order when adding to existing stack
    } else if (newInventory.length < MAX_INVENTORY_SLOTS) {
      if (newInventory.length === MAX_INVENTORY_SLOTS - 1) {
        setInventoryFull(true);
      }
      updatedInventory = [...newInventory, { ...itemDef, count: 1 }];
      // Increment item order ONLY when a new stack is created
  setNatItemOrder(updatedInventory.length);
  setItemOrder(updatedInventory.length);
    } else if (newInventory.length === MAX_INVENTORY_SLOTS && inventoryFull) {
      updatedInventory = prev;
    } else {
      updatedInventory = newInventory;
    }
    return updatedInventory;
  });
}
function useSelectedItem() {
  if (inventory[itemOrder - 1].name === 'Life Seed') {
    setMaxPlayerHP(prev => prev + 5);
    addLogMessage('Used Life Seed! Max HP increased!');
  }
  else if (inventory[itemOrder - 1].name === 'Sleep Seed') {
    setIsSleeping(true);
    addLogMessage('Vaporeon fell asleep!');
    setTimeout(() => {
      setIsSleeping(false);
      addLogMessage('Vaporeon woke up!');
    }, randInt(5000, 10000)); // Sleep for 5 to 10 seconds
  } else {
    console.log('Item use not implemented for:', inventory[itemOrder - 1].name);
    return;
  }
  
  setInventory(prev => {
    const idx = itemOrder - 1;
    if (idx < 0 || idx >= prev.length) return prev;
    const updated = [...prev];
    if (updated[idx].count > 1) {
      updated[idx].count -= 1;
    } else {
      updated.splice(idx, 1);
      setNatItemOrder(updated.length);
      setItemOrder(Math.max(1, updated.length));
    }
    if (updated.length < MAX_INVENTORY_SLOTS) {
      setInventoryFull(false);
    }
    return updated;
  });
  setShowItemActionMenu(false);
}
function discardSelectedItem() {
  setInventory(prev => {
    const idx = itemOrder - 1; // itemOrder is 1-based
    if (idx < 0 || idx >= prev.length) return prev;
    const updated = [...prev];
    if (updated[idx].count > 1) {
      updated[idx].count -= 1;
    } else {
      updated.splice(idx, 1);
      setNatItemOrder(updated.length);
      setItemOrder(Math.max(1, updated.length));
    }
    if (updated.length < MAX_INVENTORY_SLOTS) {
      setInventoryFull(false);
    }
    return updated;
  });
  setShowItemActionMenu(false);
}
function addItemTile(item) {
  setItemTiles(prev => [...prev, item]);
  const itemAdded = { ...item };
  setItemTilesIndex(prev => [...prev, itemAdded]);
  /*
  setTimeout(() => {
    setItemTiles(prev => prev.filter(tile => tile.itemName !== itemAdded.itemName));
  }, 50);
  */
}
function startCameraLoop() {
  if (cameraRafRef.current) return;
  const lerp = (a, b, t) => a + (b - a) * t;
  function step() {
    const cur = cameraPosRef.current;
    const tgt = cameraTargetRef.current;
    // small lerp factor for smooth motion (tune 0.15 - 0.35)
    //const t = 0.35;
    // adaptive lerp factor: increase responsiveness when the camera is far
    // from the target (helps with rapid player inputs) but clamp to limit overshoot.
    const dist = Math.hypot(tgt.x - cur.x, tgt.y - cur.y);
    const t = Math.min(0.6, 0.18 + dist * 0.18);
    const nx = lerp(cur.x, tgt.x, t);
    const ny = lerp(cur.y, tgt.y, t);
    cameraPosRef.current = { x: nx, y: ny };

    // compute pixel offsets like original logic but use current lerped pos
    const offsetX = (15 - nx + 1) * 40 + 20;
    const offsetY = (15 - ny - 8.5) * 40 + 20;
    const newTransform = `translate(${offsetX}px, ${offsetY}px) scale(${zoomLevel})`;

    // Apply transform directly to the dungeon DOM node to avoid re-rendering the whole tree.
    if (dungeonRef.current && dungeonRef.current.style.transform !== newTransform) {
      dungeonRef.current.style.transform = newTransform;
    }

    // stop when close enough
    if (Math.abs(tgt.x - nx) > 0.01 || Math.abs(tgt.y - ny) > 0.01) {
      cameraRafRef.current = requestAnimationFrame(step);
    } else {
      cameraRafRef.current = null;
    }
  }
  cameraRafRef.current = requestAnimationFrame(step);
}
function stopCameraLoop() {
  if (cameraRafRef.current) {
    cancelAnimationFrame(cameraRafRef.current);
    cameraRafRef.current = null;
  }
}

function revealTile(x, y) {
  setExploredTiles(prev => {
    const next = new Set(prev);
    next.add(tileKey(Math.floor(x), Math.floor(y)));
    return next;
  });
}

// reveal every tile inside a room rectangle
function revealRoom(room) {
  if (!room) return;
  setExploredTiles(prev => {
    const next = new Set(prev);
    for (let yy = room.y; yy < room.y + room.h; yy++) {
      for (let xx = room.x; xx < room.x + room.w; xx++) {
        next.add(tileKey(xx, yy));
      }
    }
    return next;
  });
}

// if player enters a room, reveal the whole room
function revealRoomIfEntered(pos) {
  if (!roomsState || roomsState.length === 0) return;
  const r = roomsState.find(room =>
    pos.x >= room.x && pos.x < room.x + room.w &&
    pos.y >= room.y && pos.y < room.y + room.h
  );
  if (r) revealRoom(r);
}

// draw minimap to canvas (simple, fast)
function drawMinimap() {
  const canvas = minimapCanvasRef.current;
  if (!canvas || !dungeon || dungeon.length === 0) return;
  const ctx = canvas.getContext('2d');
  const rows = dungeon.length;
  const cols = dungeon[0].length;
  canvas.width = MINIMAP_SIZE;
  canvas.height = MINIMAP_SIZE;
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // compute tile size and center offset to fit dungeon into canvas
  const tileW = Math.max(1, Math.floor(MINIMAP_SIZE / cols));
  const tileH = Math.max(1, Math.floor(MINIMAP_SIZE / rows));
  const t = Math.max(1, Math.min(tileW, tileH));
  const mapW = t * cols;
  const mapH = t * rows;
  const offX = Math.floor((canvas.width - mapW) / 2);
  const offY = Math.floor((canvas.height - mapH) / 2);
// draw explored tiles, walls and floors
  for (let y = 0; y < rows; y++) {
    for (let x = 0; x < cols; x++) {
      const k = tileKey(x, y);
      const explored = exploredTiles.has(k);
      const px = offX + x * t;
      const py = offY + y * t;

      if (!explored) {
        // fog (semi-transparent dark)
        ctx.fillStyle = 'rgba(0,0,0,0.8)';
        ctx.fillRect(px, py, t, t);
        continue;
      }

      const cell = dungeon[y][x];
      if (cell === 'W') {
        ctx.fillStyle = 'rgba(80,80,80,0.95)'; // wall color
      } else if (cell === 'S') {
        ctx.fillStyle = 'rgba(220,200,50,0.95)'; // stairs color
      } else {
        ctx.fillStyle = 'rgba(170,200,220,0.95)'; // floor color
      }
      ctx.fillRect(px, py, t, t);
    }
  }

  // draw items / currency (optional small dots)
  if (itemTiles && itemTiles.length) {
    ctx.fillStyle = 'rgba(255,200,0,0.95)';
    itemTiles.forEach(it => {
      const k = tileKey(Math.floor(it.x), Math.floor(it.y));
      if (!exploredTiles.has(k)) return;
      const px = offX + Math.floor(it.x) * t;
      const py = offY + Math.floor(it.y) * t;
      ctx.fillRect(px + Math.floor(t/3), py + Math.floor(t/3), Math.max(1, Math.floor(t/3)), Math.max(1, Math.floor(t/3)));
    });
  }

  // draw stairs prominently if explored
  if (stairs) {
    const k = tileKey(stairs.x, stairs.y);
    if (exploredTiles.has(k)) {
      ctx.fillStyle = 'rgba(255,220,100,1)';
      ctx.fillRect(offX + stairs.x * t, offY + stairs.y * t, t, t);
    }
  }

  // draw player as a small circle on top
  if (playerPos) {
    const px = offX + Math.floor(playerPos.x) * t + t/2;
    const py = offY + Math.floor(playerPos.y) * t + t/2;
    ctx.beginPath();
    ctx.fillStyle = 'rgba(220,60,60,1)';
    ctx.arc(px, py, Math.max(1, t/2.2), 0, Math.PI * 2);
    ctx.fill();
  }

  // subtle border
  ctx.strokeStyle = 'rgba(255,255,255,0.08)';
  ctx.strokeRect(offX + 0.5, offY + 0.5, mapW - 1, mapH - 1);
}

// ensure minimap redraws when relevant state changes
React.useEffect(() => {
  drawMinimap();
}, [dungeon, exploredTiles, playerPos, stairs, itemTiles]);

// when player moves, reveal tile and possibly whole room
React.useEffect(() => {
  if (!dungeon || dungeon.length === 0) return;
  revealTile(playerPos.x, playerPos.y);
  revealRoomIfEntered(playerPos);
}, [playerPos, roomsState]);

function createItemAnimation(trajectory, item) {
    let index = 0;
    return {
      start: () => {
        function isNewPosition(pos) {
            console.log('Is new position:', pos, !tilePositions.some(tilePositions => tilePositions.x === pos.x && tilePositions.y === pos.y));
            console.log('Current position:', pos);
            let tile = tilePositions.find(tile => tile.x && tile.y);
            console.log(tile)
            if (tile.x === pos.x) {
              console.log('Position is not new:', pos);
              console.log('tile.x:', tile.x);
              console.log('tile.y:', tile.y);
              console.log('Current position x:', pos.x);
              console.log('Current position y:', pos.y);
              return false;
            }
            else if (tile.y === pos.y) {
              console.log('Position is not new(y case):', pos);
              return false
            }
            console.log('Position is new:', pos);
            return true;
        }
        const pos1 = trajectory[1];
        const pos2 = trajectory[2];
        const pos3 = trajectory[3];
        const pos4 = trajectory[4];
        const pos5 = trajectory[5];
        const pos6 = trajectory[6];
        const pos7 = trajectory[7];
        const pos8 = trajectory[8];
        const pos9 = trajectory[9];
        const pos10 = trajectory[10];
        const pos11 = trajectory[11];
        const pos12 = trajectory[12];
        const pos13 = trajectory[13];
        const pos14 = trajectory[14];
        const pos15 = trajectory[15];
        const pos16 = trajectory[16];
        const pos17 = trajectory[17];
        const pos18 = trajectory[18];
        const pos19 = trajectory[19];
        const pos20 = trajectory[20];

        const tilePositions = [
            pos1 !== null ? pos1 : null,
            pos2 !== null ? pos2 : null,
            pos3 !== null ? pos3 : null,
            pos4 !== null ? pos4 : null,
            pos5 !== null ? pos5 : null,
            pos6 !== null ? pos6 : null,
            pos7 !== null ? pos7 : null,
            pos8 !== null ? pos8 : null,
            pos9 !== null ? pos9 : null,
            pos10 !== null ? pos10 : null,
            pos11 !== null ? pos11 : null,
            pos12 !== null ? pos12 : null,
            pos13 !== null ? pos13 : null,
            pos14 !== null ? pos14 : null,
            pos15 !== null ? pos15 : null,
            pos16 !== null ? pos16 : null,
            pos17 !== null ? pos17 : null,
            pos18 !== null ? pos18 : null,
            pos19 !== null ? pos19 : null,
            pos20 !== null ? pos20 : null
          ]
        if (isNewPosition(pos1)) {
          const tilepos1 = updateItemTilesIndex(pos1);
          console.log('newpos1:', tilepos1);
        }
        if (isNewPosition(pos2)) {
          const tilepos2 = updateItemTilesIndex(pos2);
          console.log('newpos2:', tilepos2);
        }
        if (isNewPosition(pos3)) {
          const tilepos3 = updateItemTilesIndex(pos3);
          console.log('newpos3:', tilepos3);
        }
        if (isNewPosition(pos4)) {
          const tilepos4 = updateItemTilesIndex(pos4);
          console.log('newpos4:', tilepos4);
        }
        if (isNewPosition(pos5)) {
          const tilepos5 = updateItemTilesIndex(pos5);
          console.log('newpos5:', tilepos5);
        }
        if (isNewPosition(pos6)) {
          const tilepos6 = updateItemTilesIndex(pos6);
          console.log('newpos6:', tilepos6);
        }
        if (isNewPosition(pos7)) {
          const tilepos7 = updateItemTilesIndex(pos7);
          console.log('newpos7:', tilepos7);
        }
        if (isNewPosition(pos8)) {
          const tilepos8 = updateItemTilesIndex(pos8);
          console.log('newpos8:', tilepos8);
        }
        if (isNewPosition(pos9)) {
          const tilepos9 = updateItemTilesIndex(pos9);
          console.log('newpos9:', tilepos9);
        }
        if (isNewPosition(pos10)) {
          const tilepos10 = updateItemTilesIndex(pos10);
          console.log('newpos10:', tilepos10);
        }
        if (isNewPosition(pos11)) {
          const tilepos11 = updateItemTilesIndex(pos11);
          console.log('newpos11:', tilepos11);
        }
        if (isNewPosition(pos12)) {
          const tilepos12 = updateItemTilesIndex(pos12);
          console.log('newpos12:', tilepos12);
        }
        if (isNewPosition(pos13)) {
          const tilepos13 = updateItemTilesIndex(pos13);
          console.log('newpos13:', tilepos13);
        }
        if (isNewPosition(pos14)) {
          const tilepos14 = updateItemTilesIndex(pos14)
          console.log('newpos14:', tilepos14);
        }
        if (isNewPosition(pos15)) {
          const tilepos15 = updateItemTilesIndex(pos15)
          console.log('newpos15:', tilepos15);
        }
        if (isNewPosition(pos16)) {
          const tilepos16 = updateItemTilesIndex(pos16)
          console.log('newpos16:', tilepos16);
        }
        if (isNewPosition(pos17)) {
          const tilepos17 = updateItemTilesIndex(pos17)
          console.log('newpos17:', tilepos17);
        }
        if (isNewPosition(pos18)) {
          const tilepos18 = updateItemTilesIndex(pos18)
          console.log('newpos18:', tilepos18);
        }
        if (isNewPosition(pos19)) {
          const tilepos19 = updateItemTilesIndex(pos19)
          console.log('newpos19:', tilepos19);
        }
        if (isNewPosition(pos20)) {
          const tilepos20 = updateItemTilesIndex(pos20)
          console.log('newpos20:', tilepos20);
        }
        const interval = setInterval(() => {
          console.log('Animating item to position:', trajectory[index]);
          if (index >= trajectory.length) {
            clearInterval(interval);
            let index = 0;
            return;
          }
          
          
          console.log(isNewPosition(pos1))
          if (isNewPosition(pos1)) {
            addItemTile({ itemName: item.name, x: pos1.x, y: pos1.y });
            console.log('Position added:', pos1);
          }
          setTimeout(() => {
            if (isNewPosition(pos2)) {
              addItemTile({ itemName: item.name, x: pos2.x, y: pos2.y });
               console.log('Position added:', pos2);
            }
          }, 50);
          setTimeout(() => {
            if (isNewPosition(pos3)) {
              addItemTile({ itemName: item.name, x: pos3.x, y: pos3.y });
               console.log('Position added:', pos3);
            }
          }, 100);
          setTimeout(() => {
            if (isNewPosition(pos4)) {
              addItemTile({ itemName: item.name, x: pos4.x, y: pos4.y });
               console.log('Position added:', pos4);
            }
          }, 150);
          setTimeout(() => {
            if (isNewPosition(pos5)) {
              addItemTile({ itemName: item.name, x: pos5.x, y: pos5.y });
               console.log('Position added:', pos5);
            }
          }, 200);
          setTimeout(() => {
            if (isNewPosition(pos6)) {
              addItemTile({ itemName: item.name, x: pos6.x, y: pos6.y });
               console.log('Position added:', pos6);
            }
          }, 250);
          setTimeout(() => {
            if (isNewPosition(pos7)) {
              addItemTile({ itemName: item.name, x: pos7.x, y: pos7.y });
               console.log('Position added:', pos7);
            }
          }, 300);
          setTimeout(() => {
            if (isNewPosition(pos8)) {
              addItemTile({ itemName: item.name, x: pos8.x, y: pos8.y });
               console.log('Position added:', pos8);
            }
          }, 350);
          setTimeout(() => {
            if (isNewPosition(pos9)) {
              addItemTile({ itemName: item.name, x: pos9.x, y: pos9.y });
               console.log('Position added:', pos9);
            }
          }, 400);
          setTimeout(() => {
            if (isNewPosition(pos10)) {
              addItemTile({ itemName: item.name, x: pos10.x, y: pos10.y });
               console.log('Position added:', pos10);
            }
          }, 450);
          setTimeout(() => {
            if (isNewPosition(pos11)) {
              addItemTile({ itemName: item.name, x: pos11.x, y: pos11.y });
               console.log('Position added:', pos11);
            }
          }, 500);
          setTimeout(() => {
            if (isNewPosition(pos12)) {
              addItemTile({ itemName: item.name, x: pos12.x, y: pos12.y });
               console.log('Position added:', pos12);
            }
          }, 550);
          setTimeout(() => {
            if (isNewPosition(pos13)) {
              addItemTile({ itemName: item.name, x: pos13.x, y: pos13.y });
               console.log('Position added:', pos13);
            }
          }, 600);
          setTimeout(() => {
            if (isNewPosition(pos14)) {
              addItemTile({ itemName: item.name, x: pos14.x, y: pos14.y });
               console.log('Position added:', pos14);
            }
          }, 650);
          setTimeout(() => {
            if (isNewPosition(pos15)) {
              addItemTile({ itemName: item.name, x: pos15.x, y: pos15.y });
               console.log('Position added:', pos15);
            }
          }, 700);
          setTimeout(() => {
            if (isNewPosition(pos16)) {
              addItemTile({ itemName: item.name, x: pos16.x, y: pos16.y });
               console.log('Position added:', pos16);
            }
          }, 750);
          setTimeout(() => {
            if (isNewPosition(pos17)) {
              addItemTile({ itemName: item.name, x: pos17.x, y: pos17.y });
               console.log('Position added:', pos17);
            }
          }, 800);
          setTimeout(() => {
            if (isNewPosition(pos18)) {
              addItemTile({ itemName: item.name, x: pos18.x, y: pos18.y });
               console.log('Position added:', pos18);
            }
          }, 850);
          setTimeout(() => {
            if (isNewPosition(pos19)) {
              addItemTile({ itemName: item.name, x: pos19.x, y: pos19.y });
               console.log('Position added:', pos19);
            }
          }, 900);
          setTimeout(() => {
            if (isNewPosition(pos20)) {
              addItemTile({ itemName: item.name, x: pos20.x, y: pos20.y });
               console.log('Position added:', pos20);
            }
          }, 950);
          setTimeout(() => {
            clearInterval(interval);
          }, 1000);
          
          //setItemTiles(prev => prev.map(tile => 
            //tile.itemName === item.name ?
             //{ ...tile, x: pos.x, y: pos.y }
           //   : { ...tile, x: pos.x, y: pos.y } // Keep other tiles unchanged
         // ));
        }, 50); // Update every 50ms for smoother animation
      }
    };
  }
  // Insert spawnProjectile helper (adds and animates a projectile using rAF)
function lerp(a, b, t) { return a + (b - a) * t; }
function arcOffset(t, arcHeight) { return 4 * arcHeight * t * (1 - t); }

function spawnProjectile(opts) {
  const { start, end, sprite, duration = 700, arcHeight = 2 } = opts;
  const id = 'proj_' + Date.now() + '_' + Math.random().toString(36).slice(2,8);
  const startTs = performance.now();
  // add initial projectile
  setProjectiles(prev => [...prev, { id, sprite, x: start.x, y: start.y }]);

  function step(now) {
    const elapsed = now - startTs;
    const t = Math.min(1, elapsed / duration);
    const x = lerp(start.x, end.x, t);
    const y = lerp(start.y, end.y, t) - arcOffset(t, arcHeight);

    setProjectiles(prev => prev.map(p => p.id === id ? { ...p, x, y } : p));

    if (t < 1) {
      requestAnimationFrame(step);
    } else {
      // remove after a short delay
      setTimeout(() => setProjectiles(prev => prev.filter(p => p.id !== id)), 50);
    }
  }

  requestAnimationFrame(step);
  return id;
}

function itemThrown(item) {
    const startPos = { x: playerPos.x + 0.25, y: playerPos.y}; // center of player's tile
    const dir = lastDirectionRef.current || 'right';
    const dirMap = {
      up: { x: 0, y: -6 },
      down: { x: 0, y: 6 },
      left: { x: -6, y: 0 },
      right: { x: 6, y: 0 },
      'up-left': { x: -4, y: -4 },
      'up-right': { x: 4, y: -4 },
      'down-left': { x: -4, y: 4 },
      'down-right': { x: 4, y: 4 }
    };
    const wallChecks = {
      up: { x: 0, y: -1 },
      down: { x: 0, y: 1 },
      left: { x: -1, y: 0 },
      right: { x: 1, y: 0 },
      'up-left': { x: -1, y: -1 },
      'up-right': { x: 1, y: -1 },
      'down-left': { x: -1, y: 1 },
      'down-right': { x: 1, y: 1 }
    };
    const delta = dirMap[dir] || dirMap.right;
    const wallCheck1 = wallChecks[dir] || wallChecks.right;
    const wallCheck2 = { x: wallCheck1.x * 2, y: wallCheck1.y * 2 };
    const wallCheck3 = { x: wallCheck1.x * 3, y: wallCheck1.y * 3 };
    const wallCheck4 = { x: wallCheck1.x * 4, y: wallCheck1.y * 4 };
    const wallCheck5 = { x: wallCheck1.x * 5, y: wallCheck1.y * 5 };
    const wallCheck6 = { x: wallCheck1.x * 6, y: wallCheck1.y * 6 };
    // Adjust delta if there's a wall in the way
    if (dungeon[playerPos.y + wallCheck1.y][playerPos.x + wallCheck1.x] === 'W') {
      delta.x = wallCheck1.x - wallCheck1.x;
      delta.y = wallCheck1.y - wallCheck1.y;
    }
    else if (dungeon[playerPos.y + wallCheck2.y][playerPos.x + wallCheck2.x] === 'W') {
      delta.x = wallCheck2.x - wallCheck1.x;
      delta.y = wallCheck2.y - wallCheck1.y;
    }
    else if (dungeon[playerPos.y + wallCheck3.y][playerPos.x + wallCheck3.x] === 'W') {
      delta.x = wallCheck3.x - wallCheck1.x;
      delta.y = wallCheck3.y - wallCheck1.y;
    }
    else if (dungeon[playerPos.y + wallCheck4.y][playerPos.x + wallCheck4.x] === 'W') {
      delta.x = wallCheck4.x - wallCheck1.x;
      delta.y = wallCheck4.y - wallCheck1.y;
    }
    else if (dungeon[playerPos.y + wallCheck5.y][playerPos.x + wallCheck5.x] === 'W') {
      delta.x = wallCheck5.x - wallCheck1.x;
      delta.y = wallCheck5.y - wallCheck1.y;
    }
    else if (dungeon[playerPos.y + wallCheck6.y][playerPos.x + wallCheck6.x] === 'W') {
      delta.x = wallCheck6.x - wallCheck1.x;
      delta.y = wallCheck6.y - wallCheck1.y;
    }
    const endPos = { x: startPos.x + delta.x, y: startPos.y + delta.y + 0.25 }; // slight y offset for better arc
    

    // avoid optional chaining (Babel inline): use safe access instead
    const spriteSrc = item.sprite || (ITEM_DEFS[item.name] && ITEM_DEFS[item.name].sprite) || Reviverseed;

    spawnProjectile({
      start: startPos,
      end: endPos,
      sprite: spriteSrc,
      duration: 1250,
      arcHeight: 2.2
    });

    setTimeout(() => addItemTile({ itemName: item.name, x: endPos.x - 0.25, y: endPos.y - 0.25 }), 1250);

    console.log('Item thrown:', item, 'from', startPos, 'to', endPos);
  }
React.useEffect(() => {
  setInventoryIndex(getInventoryIndex(inventory, ITEM_DEFS));
}, [inventory]);

// Flicker effect: toggle flickerFrame every 500ms if itemSelected is not null
  React.useEffect(() => {
  if (itemSelected === null) return;
  const interval = setInterval(() => {
    setFlickerFrame(prev => (prev === 0 ? 1 : 0));
  }, 500); // Flicker every 500ms
  return () => clearInterval(interval);
}, [itemSelected]);

function itemSelectDown() {
  if (natItemOrder > 1) {
    let newOrder = itemOrder + 1;
    if (newOrder > natItemOrder) newOrder = 1;
    setItemOrder(newOrder);
    console.log('Item order changed to:', newOrder);
  }
}
function itemSelectUp() {
  if (natItemOrder > 1) {
    let newOrder = itemOrder - 1;
    if (newOrder < 1) newOrder = natItemOrder;
    setItemOrder(newOrder);
    console.log('Item order changed to:', newOrder);
  }
}

function increaseLevel(){
  setLevel(prev => prev + 1);
  setMaxPlayerHP(prev => prev + 10);
  setPlayerHP(prev => Math.min(prev + 10, maxPlayerHP));
  setPlayerAttack(prev => prev + 2);
  setPlayerSpecialAttack(prev => prev + 3);
  setPlayerDefense(prev => prev + 2);
  setPlayerSpecialDefense(prev => prev + 3);
  setPlayerSpeed(prev => prev + 1);
  setLevelVfxIndex(0);
  setIsLevelingUp(true);
  setTimeout(() => {
    setIsLevelingUp(false);
  }, 2250); // Show level up for 2.25 seconds
  // Increase maxExp based on level
  const newMaxExp = Math.floor(100 * Math.pow(1.2, level - 1));
  setMaxExp(newMaxExp);
}
if (exp >= maxExp) {
  const overflow = exp - maxExp;
  setExp(overflow);
  increaseLevel();
  console.log(`Level: ${level} reached!`);
}
function generateProceduralDungeon(width, height, options = {}) {
  const {
    roomAttempts = 120,
    minRoomSize = 5,
    maxRoomSize = 8,
    maxRooms = 8,
    minRooms = 4
  } = options;
  const dungeon = Array.from({ length: height }, () => Array(width).fill('W'));
  const rooms = [];
//*

for (let i = 0; i < roomAttempts && rooms.length < randInt(minRooms, maxRooms + 1); i++) {
    const w = randInt(minRoomSize, maxRoomSize + 1);
    const h = randInt(minRoomSize, maxRoomSize + 1);
    const x = randInt(2, width - w - 2);
    const y = randInt(2, height - h - 2);
    const newRoom = makeRoom(x, y, w, h);
    console.log(roomAttempts)
if (rooms.every(room => !roomsOverlap(newRoom, room))) {
      carveRoom(dungeon, newRoom);
      rooms.push(newRoom);
    }
  }
for (let i = 1; i < rooms.length; i++) {
    carveCorridor(dungeon, rooms[i - 1].center, rooms[i].center);
  }

for (let y = 0; y < height; y++) {
    for (let x = 0; x < width; x++) {
      if (dungeon[y][x] === 'F') dungeon[y][x] = getRandomFloorTile();
    }
  }
const lastRoom = rooms[rooms.length - 1];
  if (lastRoom) dungeon[lastRoom.center.y][lastRoom.center.x] = 'S';
const firstRoom = rooms[0] || { center: { x: Math.floor(width/2), y: Math.floor(height/2) } };
return {
    dungeon,
    playerStart: { x: firstRoom.center.x, y: firstRoom.center.y },
    rooms // <-- return rooms so caller can reveal whole rooms when entered
  };
}
React.useEffect(() => {
  generateDungeon();
}, [floor]);

React.useEffect(() => {
  lastDirectionRef.current = lastDirection;
  isPausedRef.current = isPaused;
  isWalkingRef.current = isWalking;
}, [lastDirection, isPaused, isWalking]);

React.useEffect(() => {
  setIdleSpriteIndex(0);
  setWalkSpriteIndex(0);
}, [lastDirection, isWalking]);
//*

React.useEffect(() => {
const handleKeyDown = (e) => {
  if (showToolbox && itemSelected !== null) {
    if (showItemActionMenu) {
      // Scroll through actions
      if (e.key === 'w') {
        setItemActionIndex(prev => (prev - 1 + itemActions.length) % itemActions.length);
        return;
      }
      if (e.key === 's') {
        setItemActionIndex(prev => (prev + 1) % itemActions.length);
        return;
      }
      if (e.key === 'Enter') {
        // Use the current value of itemActionIndex immediately
        const selectedAction = itemActions[itemActionIndex];
        console.log('Selected action:', selectedAction);

        if (selectedAction === 'Discard') {
          discardSelectedItem();
        } else if (selectedAction === 'Throw') {
          const idx = itemOrder - 1;
          const thrownItem = inventory[idx];
          if (!thrownItem) {
            console.log('No item to throw at index', idx);
          } else {
            // remove one from stack or remove stack
            setInventory(prev => {
              if (idx < 0 || idx >= prev.length) return prev;
              const updated = [...prev];
              if (updated[idx].count > 1) {
                updated[idx].count -= 1;
              } else {
                updated.splice(idx, 1);
                setNatItemOrder(updated.length);
                setItemOrder(Math.max(1, updated.length));
              }
              if (updated.length < MAX_INVENTORY_SLOTS) setInventoryFull(false);
              return updated;
            });
      
            // visual / state effects (kept from previous logic)
            setIsSpinning(true);
            setShowItemActionMenu(false);
            setShowToolbox(false);
            setIsPaused(false);
            setTimeout(() => setIsSpinning(false), 1350);
            setTimeout(() => setIsWalking(true), 1400);
            setTimeout(() => setIsWalking(false), 1401);
      
            // actually throw the selected item
            itemThrown(thrownItem);
          }
        } else if (selectedAction === 'Use') {
          useSelectedItem();
          console.log('Used item:', itemSelected);
        }
      
        // Close action menu
        setShowItemActionMenu(false);
        return;
      }
       // ...existing code...
      if (e.key === 'Escape') {
        setShowItemActionMenu(false);
        return;
      }
    } else {
      if (e.key === 'Enter') {
        setShowItemActionMenu(true);
        setItemActionIndex(0);
        return;
      }
    }
  }
  if (e.key === 'Shift') {
    updateKeyState('shift', true); // Set Shift pressed state to true
    setShowIndicators(prev => !prev); // show indicators
  }

  let newX = playerPos.x;
  let newY = playerPos.y;

  // If toolbox is open, only handle item selection keys
  if (e.key === 'm') {
    if (!showMoveSelector){
      setShowMoveSelector(true);
      console.log('Opening move selector');
      return;
    }
    else {
      setShowMoveSelector(false);
      console.log('Closing move selector');
      return;
    }
  }
  if (showMoveSelector) {
    e.preventDefault(); // Prevent default tab behavior
    if (e.key === 'w') {
      if (selectedMove !== 0) {
        setSelectedMove(0);
      }
      else {
        setSelectedMove(2);
      }
      return;
    }
    if (e.key === 'd') {
      if (selectedMove !== 1) {
        setSelectedMove(1);
      }
      else {
        setSelectedMove(3);
      }
      return;
    }
    if (e.key === 's') {
      if (selectedMove !== 2) {
        setSelectedMove(2);
      }
      else {
        setSelectedMove(0);
      }
      return;
    }
    if (e.key === 'a') {
      if (selectedMove !== 3) {
        setSelectedMove(3);
      }
      else {
        setSelectedMove(1);
      }
      return;
    }
    if (e.key === 'Enter') {
      const selected = moves[selectedMove];
      if (selected.name === 'Acid Armor') {
        setShowMoveSelector(false);
        setIsPaused(false);
        useMove(selectedMove);
        console.log('Selected move:', selected);
        // Handle move selection logic here
      }
      if (selected.name === 'Aqua Tail') {
        setShowMoveSelector(false);
        setIsPaused(false);
        console.log('Selected move:', selected);
        // Handle move selection logic here
      }
      if (selected.name === 'Water Pulse') {
        setShowMoveSelector(false);
        setIsPaused(false);
        console.log('Selected move:', selected);
        // Handle move selection logic here
      }
      if (selected.name === 'Refresh') {
        setShowMoveSelector(false);
        setIsPaused(false);
        console.log('Selected move:', selected);
        // Handle move selection logic here
      }
      return;
    }
    // Optionally handle other move selector-specific keys here
    return;
  }
  if (showToolbox) {
    if (e.key === 'w') {
      itemSelectUp();
      return;
    }
    if (e.key === 's') {
      itemSelectDown();
      return;
    }
    // Optionally handle other toolbox-specific keys here
    return;
  }
  switch (e.key) {
    case 'Escape': // Escape key to toggle pause
      setIsPaused(prev => !prev);
    break;
  //up
  case 'w':
      if (!keyState.w) {
        updateKeyState('w', true);
        if (isAiming){
          setLastDirection('up');
        }
      }
      if (!isAiming && !inDiagonalMode && !keyState.wHeld && !isSleeping){ newY -= 1; // Move up unless Shift is pressed
        setIsWalking(true);
        triggerWalkCooldown();
        updateKeyState('wHeld', true);
        setLastDirection('up');
        const pickedCurrency = currencyTiles.find(tile => tile.x === newX && tile.y === newY);
        if (pickedCurrency) {
          setCurrency(curr => curr + pickedCurrency.amount);
          setCurrencyTiles(tiles => tiles.filter(tile => !(tile.x === newX && tile.y === newY)));
          addLogMessage(`Picked up ${pickedCurrency.amount} Pokedollars!`);
        }
        const itemHere = itemTiles.find(tile => tile.x === newX && tile.y === newY);
        if (itemHere) {
          if (!inventoryFull){
            addItemToInventory(itemHere.itemName || "Reviver Seed");
            setItemTiles(tiles => tiles.filter(tile => !(tile.x === newX && tile.y === newY)));
            setItemSelected(itemHere.id);
            addLogMessage(`Picked up ${itemHere.itemName || "Reviver Seed"}!`);
          }
          else if (inventoryFull){
            if (inventory.length < MAX_INVENTORY_SLOTS){
              setInventoryFull(false);
              addItemToInventory(itemHere.itemName || "Reviver Seed");
              setItemTiles(tiles => tiles.filter(tile => !(tile.x === newX && tile.y === newY)));
              setItemSelected(itemHere.id);
              addLogMessage(`Picked up ${itemHere.itemName || "Reviver Seed"}!`);
              return;
            }
            addLogMessage('Inventory full!');
          }
        }
      }
      break;
case 'q':
//up left
if (!keyState.q) {
updateKeyState('q', true);
}
if (keyState.q && isAiming){
  setLastDirection('up-left');
}
if (!isAiming && keyState.q && !keyState.qHeld && !isSleeping){
updateKeyState('qHeld', true);
newY -=1;
newX -=1;
setIsWalking(true);
triggerWalkCooldown();
setLastDirection('up-left');
const pickedCurrency = currencyTiles.find(tile => tile.x === newX && tile.y === newY);
if (pickedCurrency) {
  setCurrency(curr => curr + pickedCurrency.amount);
  setCurrencyTiles(tiles => tiles.filter(tile => !(tile.x === newX && tile.y === newY)));
  addLogMessage(`Picked up ${pickedCurrency.amount} Pokedollars!`);
}
const itemHere = itemTiles.find(tile => tile.x === newX && tile.y === newY);
if (itemHere) {
  if (!inventoryFull){
  addItemToInventory(itemHere.itemName || "Reviver Seed");
  setItemTiles(tiles => tiles.filter(tile => !(tile.x === newX && tile.y === newY)));
  setItemSelected(itemHere.id);
  addLogMessage(`Picked up ${itemHere.itemName || "Reviver Seed"}!`);
  }
  else if (inventoryFull){
    addLogMessage('Inventory full!');
}
}
}
break;
//down
case 's':
updateKeyState('s', true);
if (isAiming){
setLastDirection('down');
}
else if (isAiming && keyState.s && keyState.d){
setLastDirection('down-right');
}
else if (!isAiming && !inDiagonalMode && !keyState.sHeld && !isSleeping){ 
newY += 1; // Move down unless Shift is pressed
setIsWalking(true);
triggerWalkCooldown();
updateKeyState('sHeld', true);
setLastDirection('down');
const pickedCurrency = currencyTiles.find(tile => tile.x === newX && tile.y === newY);
if (pickedCurrency) {
  setCurrency(curr => curr + pickedCurrency.amount);
  setCurrencyTiles(tiles => tiles.filter(tile => !(tile.x === newX && tile.y === newY)));
  addLogMessage(`Picked up ${pickedCurrency.amount} Pokedollars!`);
}
const itemHere = itemTiles.find(tile => tile.x === newX && tile.y === newY);
if (itemHere) {
  if (!inventoryFull){
  addItemToInventory(itemHere.itemName || "Reviver Seed");
  setItemTiles(tiles => tiles.filter(tile => !(tile.x === newX && tile.y === newY)));
  setItemSelected(itemHere.id);
  addLogMessage(`Picked up ${itemHere.itemName || "Reviver Seed"}!`);
  }
  else if (inventoryFull){
    addLogMessage('Inventory full!');
}
}
}
break;
case 'c':
//down right
if (!keyState.c) {
  updateKeyState('c', true);
}
if (keyState.c && isAiming){
  setLastDirection('down-right');
}
if (!isAiming && keyState.c && !keyState.cHeld && !isSleeping){
updateKeyState('cHeld', true);
newY +=1;
newX +=1;
setIsWalking(true);
triggerWalkCooldown();
setLastDirection('down-right');
const pickedCurrency = currencyTiles.find(tile => tile.x === newX && tile.y === newY);
if (pickedCurrency) {
  setCurrency(curr => curr + pickedCurrency.amount);
  setCurrencyTiles(tiles => tiles.filter(tile => !(tile.x === newX && tile.y === newY)));
  addLogMessage(`Picked up ${pickedCurrency.amount} Pokedollars!`);
}
const itemHere = itemTiles.find(tile => tile.x === newX && tile.y === newY);
if (itemHere) {
  if (!inventoryFull){
  addItemToInventory(itemHere.itemName || "Reviver Seed");
  setItemTiles(tiles => tiles.filter(tile => !(tile.x === newX && tile.y === newY)));
  setItemSelected(itemHere.id);
  addLogMessage(`Picked up ${itemHere.itemName || "Reviver Seed"}!`);
  }
  else if (inventoryFull){
    addLogMessage('Inventory full!');
}
}
}
break;
//left
case 'a':
updateKeyState('a', true);
if (isAiming){
setLastDirection('left');
}
else if (isAiming && keyState.a && keyState.s){
setLastDirection('down-left');
}
else if (!isAiming && !inDiagonalMode && !keyState.aHeld && !isSleeping){ newX -= 1; // Move left unless Shift is pressed
setIsWalking(true);
triggerWalkCooldown();
updateKeyState('aHeld', true);
setLastDirection('left');
const pickedCurrency = currencyTiles.find(tile => tile.x === newX && tile.y === newY);
if (pickedCurrency) {
  setCurrency(curr => curr + pickedCurrency.amount);
  setCurrencyTiles(tiles => tiles.filter(tile => !(tile.x === newX && tile.y === newY)));
  addLogMessage(`Picked up ${pickedCurrency.amount} Pokedollars!`);
}
const itemHere = itemTiles.find(tile => tile.x === newX && tile.y === newY);
if (itemHere) {
  if (!inventoryFull){
  addItemToInventory(itemHere.itemName || "Reviver Seed");
  setItemTiles(tiles => tiles.filter(tile => !(tile.x === newX && tile.y === newY)));
  setItemSelected(itemHere.id);
  addLogMessage(`Picked up ${itemHere.itemName || "Reviver Seed"}!`);
  }
  else if (inventoryFull){
    addLogMessage('Inventory full!');
}
}
}
break;
case 'z':
if (!keyState.z) {
  updateKeyState('z', true);
}
if (keyState.z && isAiming){
setLastDirection('down-left');
}
//down left
if (!isAiming && keyState.z && !keyState.zHeld && !isSleeping){
updateKeyState('zHeld', true);
newY +=1;
newX -=1;
setIsWalking(true);
triggerWalkCooldown();
setLastDirection('down-left');
const pickedCurrency = currencyTiles.find(tile => tile.x === newX && tile.y === newY);
if (pickedCurrency) {
  setCurrency(curr => curr + pickedCurrency.amount);
  setCurrencyTiles(tiles => tiles.filter(tile => !(tile.x === newX && tile.y === newY)));
  addLogMessage(`Picked up ${pickedCurrency.amount} Pokedollars!`);
}
const itemHere = itemTiles.find(tile => tile.x === newX && tile.y === newY);
if (itemHere) {
  if (!inventoryFull){
  addItemToInventory(itemHere.itemName || "Reviver Seed");
  setItemTiles(tiles => tiles.filter(tile => !(tile.x === newX && tile.y === newY)));
  setItemSelected(itemHere.id);
  addLogMessage(`Picked up ${itemHere.itemName || "Reviver Seed"}!`);
  }
  else if (inventoryFull){
    addLogMessage('Inventory full!');
}
}
}
break;
//right
case 'd':
updateKeyState('d', true);
if (isAiming){
setLastDirection('right');
}
else if (isAiming && keyState.d && keyState.w){
setLastDirection('up-right');
}
else if (!isAiming && !inDiagonalMode && !keyState.dHeld && !isSleeping){ newX += 1; // Move right unless Shift is pressed
setIsWalking(true);
triggerWalkCooldown();
updateKeyState('dHeld', true);
setLastDirection('right');
const pickedCurrency = currencyTiles.find(tile => tile.x === newX && tile.y === newY);
if (pickedCurrency) {
  setCurrency(curr => curr + pickedCurrency.amount);
  setCurrencyTiles(tiles => tiles.filter(tile => !(tile.x === newX && tile.y === newY)));
  addLogMessage(`Picked up ${pickedCurrency.amount} Pokedollars!`);
}
const itemHere = itemTiles.find(tile => tile.x === newX && tile.y === newY);
if (itemHere) {
  if (!inventoryFull){
  addItemToInventory(itemHere.itemName || "Reviver Seed");
  setItemTiles(tiles => tiles.filter(tile => !(tile.x === newX && tile.y === newY)));
  setItemSelected(itemHere.id);
  addLogMessage(`Picked up ${itemHere.itemName || "Reviver Seed"}!`);
  }
  else if (inventoryFull){
    addLogMessage('Inventory full!');
}
}
}
break;
case 'e':
if (!keyState.e) {
  updateKeyState('e', true);
}
if (isAiming && keyState.e){
  setLastDirection('up-right');
}
//up right
if (!isAiming && keyState.e && !keyState.eHeld && !isSleeping){
updateKeyState('eHeld', true);
newY -=1;
newX +=1;
setIsWalking(true);
triggerWalkCooldown();
setLastDirection('up-right');
const pickedCurrency = currencyTiles.find(tile => tile.x === newX && tile.y === newY);
if (pickedCurrency) {
  setCurrency(curr => curr + pickedCurrency.amount);
  setCurrencyTiles(tiles => tiles.filter(tile => !(tile.x === newX && tile.y === newY)));
  addLogMessage(`Picked up ${pickedCurrency.amount} Pokedollars!`);
}
const itemHere = itemTiles.find(tile => tile.x === newX && tile.y === newY);
if (itemHere) {
  if (!inventoryFull){
  addItemToInventory(itemHere.itemName || "Reviver Seed");
  setItemTiles(tiles => tiles.filter(tile => !(tile.x === newX && tile.y === newY)));
  setItemSelected(itemHere.id);
  addLogMessage(`Picked up ${itemHere.itemName || "Reviver Seed"}!`);
  }
  else if (inventoryFull){
    addLogMessage('Inventory full!');
}
}
}
break;
case 'p': // debug for exp
if (exp < maxExp) {
  setExp(prev => prev + 200); // Add 200 EXP for testing
  addLogMessage(`Gained 200 EXP! Current EXP: ${exp + 200}`);
}
break;
case 'Shift': // Shift key to toggle aim mode
if (inDiagonalMode){
setInDiagonalMode(false);
}
setIsAiming(prev => !prev);
return;
default:
return;
break;
case 'l':
//quick log
console.log('Moves:', moves);
console.log('item tile index:', itemTilesIndex);
console.log('Player position:', playerPos);
console.log('Ispositionwall?', dungeon[playerPos.y][playerPos.x] === 'W');
console.log('Ispositiondownwall?', dungeon[playerPos.y + 1][playerPos.x] === 'W');
console.log('Ispositionupwall?', dungeon[playerPos.y - 1][playerPos.x] === 'W');
console.log('Ispositionleftwall?', dungeon[playerPos.y][playerPos.x - 1] === 'W');
console.log('Ispositionrightwall?', dungeon[playerPos.y][playerPos.x + 1] === 'W');
console.log('Ispositionupleftwall?', dungeon[playerPos.y - 1][playerPos.x - 1] === 'W');
console.log('Ispositionuprightwall?', dungeon[playerPos.y - 1][playerPos.x + 1] === 'W');
console.log('Ispositiondownleftwall?', dungeon[playerPos.y + 1][playerPos.x - 1] === 'W');
console.log('Ispositiondownrightwall?', dungeon[playerPos.y + 1][playerPos.x + 1] === 'W');
console.log('Dungeon:', dungeon);
  break;
}

// Check for collision with walls only if not paused and not holding Shift
const moveCheck = (() => {
  if (isAiming) return { ok: false, reason: 'isAiming' };
  if (isPaused) return { ok: false, reason: 'isPaused' };
  if (keyState.shift) return { ok: false, reason: 'shift held' };
  if (newY < 0 || newY >= height || newX < 0 || newX >= width) return { ok: false, reason: 'out of bounds' };
  if (!Array.isArray(dungeon) || dungeon.length === 0) return { ok: false, reason: 'dungeon not initialized' };
  if (!dungeon[newY]) return { ok: false, reason: 'dungeon row undefined', rowLen: dungeon.length };
  const tile = dungeon[newY][newX];
  if (tile === 'W') return { ok: false, reason: 'wall', tile };
  if (typeof tile === 'undefined' || tile === null) return { ok: false, reason: 'tile undefined', tile };
  return { ok: true, reason: 'ok', tile };
})();

if (moveCheck.ok) {
  setPlayerPos({ x: newX, y: newY });
  updateCamera(newX, newY);
} else {
  console.log('Movement blocked:', moveCheck.reason,
    'new:', newX, newY,
    'tile:', moveCheck.tile,
    'dungeonRows:', Array.isArray(dungeon) ? dungeon.length : 'N/A',
    'height/width:', height, width,
    'isAiming:', isAiming, 'isPaused:', isPaused, 'shift:', keyState.shift);
}

if (newX === stairs.x && newY === stairs.y) {
alert('You found the stairs! Onward!');
setFloor((prevFloor) => prevFloor + 1);
}
};

const handleKeyUp = (e) => {
if (e.key === 'q'){
updateKeyState('qHeld', false);
}
if (e.key === 'e'){
updateKeyState('eHeld', false);
}
if (e.key === 'z'){
updateKeyState('zHeld', false);
}
if (e.key === 'c'){
updateKeyState('cHeld', false);
}
if (e.key === 'Shift') {
updateKeyState('shift', false); // Set Shift pressed state to false
}
if (e.key === 'w') {
updateKeyState('w', false);
updateKeyState('wHeld', false);
//triggerWalkCooldown()
}
if (e.key === 'a') {
updateKeyState('a', false);
updateKeyState('aHeld', false);
//triggerWalkCooldown();
}
if (e.key === 's') {
updateKeyState('s', false);
updateKeyState('sHeld', false);
//triggerWalkCooldown();
}
if (e.key === 'd') {
updateKeyState('d', false);
updateKeyState('dHeld', false);
//triggerWalkCooldown();
}
};

window.addEventListener('keydown', handleKeyDown);
window.addEventListener('keyup', handleKeyUp);
return () => {
window.removeEventListener('keydown', handleKeyDown);
window.removeEventListener('keyup', handleKeyUp);
};
}, [playerPos, stairs, dungeon, isPaused, keyState.shift, showToolbox, itemOrder, natItemOrder, showItemActionMenu, itemActionIndex, isWalking, isSleeping, showMoveSelector, selectedMove]); // Add isShiftPressed to dependencies

// Replace multiple setInterval animation effects with this single rAF loop + preload
const ANIM_TIMINGS = {
  idle: 500,
  walk: 300,
  spin: 150,
  sleep: 500,
  level: 150,
  buff: 150
};

const animRafRef = React.useRef(null);
const lastAnimTsRef = React.useRef(0);
const indicesRef = React.useRef({
  idle: 0,
  walk: 0,
  spin: 0,
  sleep: 0,
  level: 0,
  buff: 0
});

// Ensure refs reflect current flags/direction (some already exist above)
React.useEffect(() => {
  lastDirectionRef.current = lastDirection;
  isPausedRef.current = isPaused;
  isWalkingRef.current = isWalking;
}, [lastDirection, isPaused, isWalking]);

// Preload arrays (call with array of urls)
function preloadImages(urls = []) {
  urls.forEach(u => {
    if (!u) return;
    const img = new Image();
    img.src = u;
  });
}

// Collect sprite URL arrays to preload (trim or extend as needed)
React.useEffect(() => {
  const allSprites = [
    ...vaporeonSprites,
    ...vaporeonLeftSprites,
    ...vaporeonRightSprites,
    ...vaporeonUpSprites,
    ...vaporeonDownWalkSprites,
    ...vaporeonUpWalkSprites,
    ...vaporeonLeftWalkSprites,
    ...vaporeonRightWalkSprites,
    ...vaporeonDownRightWalkSprites,
    ...vaporeonDownLeftWalkSprites,
    ...vaporeonUpRightWalkSprites,
    ...vaporeonUpLeftWalkSprites,
    ...vaporeonDownSpinSprites,
    ...vaporeonUpSpinSprites,
    ...vaporeonLeftSpinSprites,
    ...vaporeonRightSpinSprites,
    ...vaporeonDownLeftSpinSprites,
    ...vaporeonDownRightSpinSprites,
    ...vaporeonUpLeftSpinSprites,
    ...vaporeonUpRightSpinSprites,
    ...vaporeonSleepSprites,
    ...levelVfxFrames,
    ...buffVfxFrames,
    // add spin arrays if not huge...
  ];
  preloadImages(allSprites);
}, []);

// rAF animation driver
React.useEffect(() => {
  function step(ts) {
    if (!lastAnimTsRef.current) lastAnimTsRef.current = ts;
    const elapsed = ts - lastAnimTsRef.current;

    // Idle animation (when not walking, spinning, sleeping, or paused)
    if (!isWalkingRef.current && !isSpinning && !isSleeping && !isPausedRef.current) {
      if (elapsed >= ANIM_TIMINGS.idle) {
        lastAnimTsRef.current = ts;
        indicesRef.current.idle = (indicesRef.current.idle + 1) % vaporeonSprites.length;
        // Only update visible idle index state if it changed (minimize setState)
        setIdleSpriteIndex(indicesRef.current.idle);
      }
    }

    // Walk animation
    if (isWalkingRef.current && !isPausedRef.current) {
      if (elapsed >= ANIM_TIMINGS.walk) {
        lastAnimTsRef.current = ts;
        indicesRef.current.walk = (indicesRef.current.walk + 1) % vaporeonDownWalkSprites.length; // length used as baseline
        setWalkSpriteIndex(indicesRef.current.walk);
      }
    }

    // Spin animation
    if (isSpinning) {
      if (elapsed >= ANIM_TIMINGS.spin) {
        lastAnimTsRef.current = ts;
        indicesRef.current.spin = (indicesRef.current.spin + 1) % vaporeonDownSpinSprites.length;
        setSpinSpriteIndex(indicesRef.current.spin);
      }
    }

    // Sleep animation
    if (isSleeping) {
      if (elapsed >= ANIM_TIMINGS.sleep) {
        lastAnimTsRef.current = ts;
        indicesRef.current.sleep = (indicesRef.current.sleep + 1) % vaporeonSleepSprites.length;
        setSleepSpriteIndex(indicesRef.current.sleep);
      }
    }

    // Level VFX
    if (isLevelingUp) {
      if (elapsed >= ANIM_TIMINGS.level) {
        lastAnimTsRef.current = ts;
        indicesRef.current.level = (indicesRef.current.level + 1) % levelVfxFrames.length;
        setLevelVfxIndex(indicesRef.current.level);
      }
    }

    // Buff VFX
    if (isBuffing) {
      if (elapsed >= ANIM_TIMINGS.buff) {
        lastAnimTsRef.current = ts;
        indicesRef.current.buff = (indicesRef.current.buff + 1) % buffVfxFrames.length;
        setBuffVfxIndex(indicesRef.current.buff);
      }
    }

    animRafRef.current = requestAnimationFrame(step);
  }

  animRafRef.current = requestAnimationFrame(step);
  return () => {
    if (animRafRef.current) cancelAnimationFrame(animRafRef.current);
    animRafRef.current = null;
  };
}, [isSpinning, isSleeping, isLevelingUp, isBuffing]); // flags that change animation sets

const generateDungeon = () => {
   const stateWidth = width, stateHeight = height;
   const { dungeon: newDungeon, playerStart, rooms } = generateProceduralDungeon(stateWidth, stateHeight);
 
   setExploredTiles(() => {
     // ensure new Set object so drawMinimap treats it as change
     return new Set();
   });
   if (minimapCanvasRef.current) {
     const c = minimapCanvasRef.current;
     const ctx = c.getContext && c.getContext('2d');
     c.width = MINIMAP_SIZE;
     c.height = MINIMAP_SIZE;
     if (ctx) ctx.clearRect(0, 0, c.width, c.height);
   }

  // Find stairs position
  let stairX = 0, stairY = 0;
  for (let y = 0; y < stateHeight; y++) {
    for (let x = 0; x < stateWidth; x++) {
      if (newDungeon[y][x] === 'S') {
        stairX = x;
        stairY = y;
      }
    }
  }
const currencyLocs = generateCurrencyTiles(newDungeon, 20, 80, 5); // 5 coins, value 20-80
  setCurrencyTiles(currencyLocs);
const itemLocs = generateItemTiles(newDungeon, 5, 10, randInt(5, 10)); // between 5 and 10 items spawn
  setItemTiles(itemLocs);
  beginItemTilesIndex(itemLocs);
  setStairs({ x: stairX, y: stairY });
  setPlayerPos(playerStart);
  setDungeon(newDungeon);
  // set rooms and reveal starting room
  setRoomsState(rooms || []);
  // reveal the starting room entirely
  if (rooms && rooms.length) {
    const startRoom = rooms.find(r => r.center.x === playerStart.x && r.center.y === playerStart.y) || rooms[0];
    revealRoom(startRoom);
  } else {
    // fallback: reveal starting tile
    revealTile(playerStart.x, playerStart.y);
  }

  // Reset camera refs to avoid sudden jumps/stutter and smooth to new start
  cameraPosRef.current = { x: playerStart.x, y: playerStart.y };
  cameraTargetRef.current = { x: playerStart.x, y: playerStart.y };
  // Immediately apply the transform to the DOM node (if available) so we don't
  // briefly display the previous floor's camera position.
  const offsetX = (15 - playerStart.x + 1) * 40 + 20;
  const offsetY = (15 - playerStart.y - 8.5) * 40 + 20;
  const immediateTransform = `translate(${offsetX}px, ${offsetY}px) scale(${zoomLevel})`;
  if (dungeonRef.current) dungeonRef.current.style.transform = immediateTransform;
  // Start smoothing toward the target (will no-op if already near)
  updateCamera(playerStart.x, playerStart.y);
};

const getRandomFloorTile = () => {
 return floorSprites[Math.floor(Math.random() * floorSprites.length)];
};
 
 const updateCamera = (x, y) => {
   cameraTargetRef.current = { x, y };
   // Ensure cameraPosRef isn't NaN/uninitialized after floor change
   if (typeof cameraPosRef.current.x !== 'number' || typeof cameraPosRef.current.y !== 'number') {
     cameraPosRef.current = { x, y };
     // set immediate transform for the first frame
     const offsetX = (15 - x + 1) * 40 + 20;
     const offsetY = (15 - y - 8.5) * 40 + 20;
     if (dungeonRef.current) dungeonRef.current.style.transform = `translate(${offsetX}px, ${offsetY}px) scale(${zoomLevel})`;
     return;
   }
   startCameraLoop();
 };
 React.useEffect(() => {
   return () => {
     stopCameraLoop();
   };
 }, []);

const getLineCoordinates = (direction) => {
const lineCoords = [];
let x = playerPos.x;
let y = playerPos.y;

for (let i = 0; i < 30; i++) { // Extend infinitely until hitting a wall
if (direction === 'up' && y - i >= 0) {
if (dungeon[y - i][x] === 'W') break; // Stop if it hits a wall
lineCoords.push({ x: x, y: y - i });
} else if (direction === 'down' && y + i < 30) {
if (dungeon[y + i][x] === 'W') break; // Stop if it hits a wall
lineCoords.push({ x: x, y: y + i });
} else if (direction === 'left' && x - i >= 0) {
if (dungeon[y][x - i] === 'W') break; // Stop if it hits a wall
lineCoords.push({ x: x - i, y: y });
} else if (direction === 'right' && x + i < 30) {
if (dungeon[y][x + i] === 'W') break; // Stop if it hits a wall
lineCoords.push({ x: x + i, y: y });
}
}
return lineCoords;
};

const lineCoordinates = showIndicators ? getLineCoordinates(lastDirection) : [];

return (
  <div>
    {showMoveSelector && (
      <div
        className="menu"
        style={{
          position: "absolute",
          top: "50%",
          left: "50%",
          transform: "translate(-50%, -50%)",
          width: 320,
          height: 320,
          borderRadius: "50%",
          background: "rgba(0,0,0,0.85)",
          zIndex: 1000,
          display: "flex",
          alignItems: "center",
          justifyContent: "center",
          pointerEvents: "auto"
        }}
      >
        <svg width="320" height="320" style={{ position: "absolute", top: 0, left: 0 }}>
          {[0, 1, 2, 3].map(i => {
            const sectorAngle = (i * 90 - 45) * (Math.PI / 180);
            // Move text position slightly inward
            const textRadius = 65;
            const textAngle = sectorAngle - 42.5 * (Math.PI / 180);
            const x = 160 + textRadius * Math.cos(textAngle);
            const y = 160 + textRadius * Math.sin(textAngle);
            return (
              <g key={i}>
                <path
                  d={describeArc(160, 160, 120, i * 90 - 45, (i + 1) * 90 - 45)}
                  fill={selectedMove === i ? "#3490dc" : "#222"}
                  stroke="#fff"
                  strokeWidth="2"
                />
                <text
                  x={x}
                  y={y}
                  textAnchor="middle"
                  alignmentBaseline="middle"
                  fill="#fff"
                  fontSize="18"
                  fontWeight={selectedMove === i ? "bold" : "normal"}
                  style={{ pointerEvents: "none", userSelect: "none" }}
                >
                  {moves[i].name}
                  <tspan x={x} dy="1.2em" fontSize="14" fill="#ccc">
                    {moves[i].pp}
                  </tspan>
                </text>
              </g>
            );
          })}
        </svg>
      </div>
    )}
    <div className="game-area p-4">
      <div className="counter">Floor: {floor}</div>
      <div className="counter" style={{ right: '150px' }}>
        <img src={Pokedollar} alt="Currency" style={{ width: 24, verticalAlign: 'middle' }} /> {currency}
      </div>
      {/* Minimap (top-right) */}
      <canvas
        ref={minimapCanvasRef}
        width={MINIMAP_SIZE}
        height={MINIMAP_SIZE}
        style={{
          position: 'absolute',
          top: '10%',
          right: 8,
          width: MINIMAP_SIZE,
          height: MINIMAP_SIZE,
          background: 'rgba(0,0,0,0.35)',
          border: '1px solid rgba(255,255,255,0.08)',
          borderRadius: 6,
          zIndex: 110,
          pointerEvents: 'none' // non-interactive overlay
        }}
      />
      <div className="dungeon-container">
        <div className="dungeon" ref={dungeonRef} style={{ 
          transform: cameraTransform,
          width: '7680px',
          height: '7680px',
        }}>
          {dungeon.map((row, rowIndex) => (
            <div key={rowIndex} className="dungeon-row flex">
              {row.map((cell, colIndex) => {
                let wallSprite;
                const currencyHere = currencyTiles.find(tile => tile.x === colIndex && tile.y === rowIndex);
                const itemHere = itemTiles.find(tile => tile.x === colIndex && tile.y === rowIndex);
                //console.log(itemHere);
                // Determine sprite based on position
                if (cell === 'W') {
                  wallSprite = wallSpriteMap[getWallTileType(colIndex, rowIndex, dungeon)];
                }

                const isIndicatorVisible = lineCoordinates.some(coord => coord.x === colIndex && coord.y === rowIndex) && !(playerPos.x === colIndex && playerPos.y === rowIndex);

                return (
                  <div key={colIndex} className={`dungeon-cell relative w-10 h-10 ${isIndicatorVisible && showIndicators ? 'red-border' : ''}`}>
                    {cell === 'W' ? (
                      <img src={wallSprite} alt="Wall" className="wall absolute" />
                    ) : (
                      <img src={cell} alt="Floor" className="floor absolute" />
                    )}
                    {cell === 'S' && (
                      <img src={stairSprite} alt="Stairs" className="stair absolute" />
                    )}
                    {currencyHere && (
                      <img src={Pokedollar} alt="Currency" className="absolute w-full h-full" style={{
                        zIndex: 5,
                        objectFit: 'contain',
                        width: '50%',
                        height: '50%',
                        left: '25%',
                        top: '25%',
                      }} />
                    )}
                    {itemHere && (
                      <img src={ITEM_DEFS[itemHere.itemName].sprite} alt={itemHere.itemName} className="absolute w-full h-full" style={{
                        zIndex: 5,
                        objectFit: 'contain',
                        width: '50%',
                        height: '50%',
                        left: '25%',
                        top: '25%',
                      }} />
                    )}
                    {isBuffing && playerPos.x === colIndex && playerPos.y === rowIndex && (
                      <img
                        src={buffVfxFrames[buffVfxIndex]}
                        alt="Buff"
                        className="absolute w-full h-full"
                        style={{
                          transform: 'translateY(-20%)',
                          zIndex: 31,
                          pointerEvents: 'none',
                          animation: 'buff-fade 1s forwards',
                        }}
                      />
                    )}
                    {isLevelingUp && playerPos.x === colIndex && playerPos.y === rowIndex && (
                      <img
                        src={levelVfxFrames[levelVfxIndex]}
                        alt="Level Up"
                        className="absolute w-full h-full"
                        style={{
                          transform: 'translateY(-20%)',
                          zIndex: 31,
                          pointerEvents: 'none',
                          animation: 'level-up-fade 1s forwards',
                        }}
                      />
                    )}
                    {playerPos.x === colIndex && playerPos.y === rowIndex && (
                      <img
                        src={
                          isSleeping
                            ? vaporeonSleepSprites[sleepSpriteIndex]
                            : isWalking
                              ? (lastDirection === 'left' ? vaporeonLeftWalkSprites[walkSpriteIndex]
                                : lastDirection === 'right' ? vaporeonRightWalkSprites[walkSpriteIndex]
                                : lastDirection === 'up' ? vaporeonUpWalkSprites[walkSpriteIndex]
                                : lastDirection === 'down' ? vaporeonDownWalkSprites[walkSpriteIndex]
                                : lastDirection === 'up-left' ? vaporeonUpLeftWalkSprites[walkSpriteIndex]
                                : lastDirection === 'up-right' ? vaporeonUpRightWalkSprites[walkSpriteIndex]
                                : lastDirection === 'down-left' ? vaporeonDownLeftWalkSprites[walkSpriteIndex]
                                : lastDirection === 'down-right' ? vaporeonDownRightWalkSprites[walkSpriteIndex]
                                : vaporeonSprites[idleSpriteIndex])
                              : isSpinning
                                ? (lastDirection === 'left' ? vaporeonLeftSpinSprites[spinSpriteIndex]
                                  : lastDirection === 'right' ? vaporeonRightSpinSprites[spinSpriteIndex]
                                  : lastDirection === 'up' ? vaporeonUpSpinSprites[spinSpriteIndex]
                                  : lastDirection === 'down' ? vaporeonDownSpinSprites[spinSpriteIndex]
                                  : lastDirection === 'up-left' ? vaporeonUpLeftSpinSprites[spinSpriteIndex]
                                  : lastDirection === 'up-right' ? vaporeonUpRightSpinSprites[spinSpriteIndex]
                                  : lastDirection === 'down-left' ? vaporeonDownLeftSpinSprites[spinSpriteIndex]
                                  : lastDirection === 'down-right' ? vaporeonDownRightSpinSprites[spinSpriteIndex]
                                  : vaporeonSprites[idleSpriteIndex])
                                : (lastDirection === 'left' ? vaporeonLeftSprites[idleSpriteIndex]
                                  : lastDirection === 'right' ? vaporeonRightSprites[idleSpriteIndex]
                                  : lastDirection === 'up' ? vaporeonUpSprites[idleSpriteIndex]
                                  : lastDirection === 'down' ? vaporeonSprites[idleSpriteIndex]
                                  : lastDirection === 'down-left' ? vaporeonDownLeftSprites[idleSpriteIndex]
                                  : lastDirection === 'down-right' ? vaporeonDownRightSprites[idleSpriteIndex]
                                  : lastDirection === 'up-left' ? vaporeonUpLeftSprites[idleSpriteIndex]
                                  : lastDirection === 'up-right' ? vaporeonUpRightSprites[idleSpriteIndex]
                                  : vaporeonSprites[idleSpriteIndex]) // Default sprite when not walking
                        }
                              alt="Vaporeon"
                        className="player-sprite absolute"
                        style={{
                          transform: isSpinning ? 'scale(0.85)' : 'scale(1)',
                        }}
                        />
                    )}
                  </div>
                )
              })}
            </div>
          ))}

          {/* Render projectiles inside the dungeon so they follow camera transform */}
          {projectiles.map(p => (
            <img
              key={p.id}
              src={p.sprite}
              alt="thrown"
              style={{
                position: 'absolute',
                left: `${p.x * 40}px`,
                top: `${p.y * 40}px`,
                width: '20px',
                height: '20px',
                transformOrigin: 'center',
                zIndex: 40,
                pointerEvents: 'none',
                objectFit: 'contain'
              }}
            />
          ))}
        </div>
        <div
              style={{
                position: 'absolute',
                left: '50%',
                bottom: '30px',
                transform: 'translateX(-50%)',
                width: '60%',
                maxHeight: '120px',
                background: 'rgba(30,30,30,0.5)',
                color: 'white',
                padding: '10px',
                borderRadius: '8px',
                overflowY: 'auto',
                fontSize: '16px',
                zIndex: 30,
                pointerEvents: 'none',
              }}
            >
              {actionLog.map(entry => (
    <div key={entry.id}>{entry.msg}</div>
  ))}
        </div>
      </div>
        <div className="absolute top-0 left-0 w-full h-full flex items-left justify-left"
           style={{
            position: 'absolute',
            transform: 'translateY(100%)',
            width: '100%',
            height: '50px',
            marginTop: '40px',
            opacity: '0.8',

          }}>
        <img src={
           0 <= exp/maxExp && exp/maxExp < 0.01 ? expBarComponent0
          : exp/maxExp === 1 ? expBarComponent100
          : 0.01 <= exp/maxExp && exp/maxExp < 0.02 ? expBarComponent1
          : 0.02 <= exp/maxExp && exp/maxExp < 0.03 ? expBarComponent2
          : 0.03 <= exp/maxExp && exp/maxExp < 0.04 ? expBarComponent3
          : 0.04 <= exp/maxExp && exp/maxExp < 0.05 ? expBarComponent4
          : 0.05 <= exp/maxExp && exp/maxExp < 0.06 ? expBarComponent5
          : 0.06 <= exp/maxExp && exp/maxExp < 0.07 ? expBarComponent6
          : 0.07 <= exp/maxExp && exp/maxExp < 0.08 ? expBarComponent7
          : 0.08 <= exp/maxExp && exp/maxExp < 0.09 ? expBarComponent8
          : 0.09 <= exp/maxExp && exp/maxExp < 0.1 ? expBarComponent9
          : 0.1 <= exp/maxExp && exp/maxExp < 0.11 ? expBarComponent10
          : 0.11 <= exp/maxExp && exp/maxExp < 0.12 ? expBarComponent11
          : 0.12 <= exp/maxExp && exp/maxExp < 0.13 ? expBarComponent12
          : 0.13 <= exp/maxExp && exp/maxExp < 0.14 ? expBarComponent13
          : 0.14 <= exp/maxExp && exp/maxExp < 0.15 ? expBarComponent14
          : 0.15 <= exp/maxExp && exp/maxExp < 0.16 ? expBarComponent15
          : 0.16 <= exp/maxExp && exp/maxExp < 0.17 ? expBarComponent16
          : 0.17 <= exp/maxExp && exp/maxExp < 0.18 ? expBarComponent17
          : 0.18 <= exp/maxExp && exp/maxExp < 0.19 ? expBarComponent18
          : 0.19 <= exp/maxExp && exp/maxExp < 0.2 ? expBarComponent19
          : 0.2 <= exp/maxExp && exp/maxExp < 0.21 ? expBarComponent20
          : 0.21 <= exp/maxExp && exp/maxExp < 0.22 ? expBarComponent21
          : 0.22 <= exp/maxExp && exp/maxExp < 0.23 ? expBarComponent22
          : 0.23 <= exp/maxExp && exp/maxExp < 0.24 ? expBarComponent23
          : 0.24 <= exp/maxExp && exp/maxExp < 0.25 ? expBarComponent24
          : 0.25 <= exp/maxExp && exp/maxExp < 0.26 ? expBarComponent25
          : 0.26 <= exp/maxExp && exp/maxExp < 0.27 ? expBarComponent26
          : 0.27 <= exp/maxExp && exp/maxExp < 0.28 ? expBarComponent27
          : 0.28 <= exp/maxExp && exp/maxExp < 0.29 ? expBarComponent28
          : 0.29 <= exp/maxExp && exp/maxExp < 0.3 ? expBarComponent29
          : 0.3 <= exp/maxExp && exp/maxExp < 0.31 ? expBarComponent30
          : 0.31 <= exp/maxExp && exp/maxExp < 0.32 ? expBarComponent31
          : 0.32 <= exp/maxExp && exp/maxExp < 0.33 ? expBarComponent32
          : 0.33 <= exp/maxExp && exp/maxExp < 0.34 ? expBarComponent33
          : 0.34 <= exp/maxExp && exp/maxExp < 0.35 ? expBarComponent34
          : 0.35 <= exp/maxExp && exp/maxExp < 0.36 ? expBarComponent35
          : 0.36 <= exp/maxExp && exp/maxExp < 0.37 ? expBarComponent36
          : 0.37 <= exp/maxExp && exp/maxExp < 0.38 ? expBarComponent37
          : 0.38 <= exp/maxExp && exp/maxExp < 0.39 ? expBarComponent38
          : 0.39 <= exp/maxExp && exp/maxExp < 0.4 ? expBarComponent39
          : 0.4 <= exp/maxExp && exp/maxExp < 0.41 ? expBarComponent40
          : 0.41 <= exp/maxExp && exp/maxExp < 0.42 ? expBarComponent41
          : 0.42 <= exp/maxExp && exp/maxExp < 0.43 ? expBarComponent42
          : 0.43 <= exp/maxExp && exp/maxExp < 0.44 ? expBarComponent43
          : 0.44 <= exp/maxExp && exp/maxExp < 0.45 ? expBarComponent44
          : 0.45 <= exp/maxExp && exp/maxExp < 0.46 ? expBarComponent45
          : 0.46 <= exp/maxExp && exp/maxExp < 0.47 ? expBarComponent46
          : 0.47 <= exp/maxExp && exp/maxExp < 0.48 ? expBarComponent47
          : 0.48 <= exp/maxExp && exp/maxExp < 0.49 ? expBarComponent48
          : 0.49 <= exp/maxExp && exp/maxExp < 0.5 ? expBarComponent49
          : 0.5 <= exp/maxExp && exp/maxExp < 0.51 ? expBarComponent50
          : 0.51 <= exp/maxExp && exp/maxExp < 0.52 ? expBarComponent51
          : 0.52 <= exp/maxExp && exp/maxExp < 0.53 ? expBarComponent52
          : 0.53 <= exp/maxExp && exp/maxExp < 0.54 ? expBarComponent53
          : 0.54 <= exp/maxExp && exp/maxExp < 0.55 ? expBarComponent54
          : 0.55 <= exp/maxExp && exp/maxExp < 0.56 ? expBarComponent55
          : 0.56 <= exp/maxExp && exp/maxExp < 0.57 ? expBarComponent56
          : 0.57 <= exp/maxExp && exp/maxExp < 0.58 ? expBarComponent57
          : 0.58 <= exp/maxExp && exp/maxExp < 0.59 ? expBarComponent58
          : 0.59 <= exp/maxExp && exp/maxExp < 0.6 ? expBarComponent59
          : 0.6 <= exp/maxExp && exp/maxExp < 0.61 ? expBarComponent60
          : 0.61 <= exp/maxExp && exp/maxExp < 0.62 ? expBarComponent61
          : 0.62 <= exp/maxExp && exp/maxExp < 0.63 ? expBarComponent62
          : 0.63 <= exp/maxExp && exp/maxExp < 0.64 ? expBarComponent63
          : 0.64 <= exp/maxExp && exp/maxExp < 0.65 ? expBarComponent64
          : 0.65 <= exp/maxExp && expMaxExp < 0.66 ? expBarComponent65
          : 0.66 <= exp/maxExp && exp/maxExp < 0.67 ? expBarComponent66
          : 0.67 <= exp/maxExp && exp/maxExp < 0.68 ? expBarComponent67
          : 0.68 <= exp/maxExp && exp/maxExp < 0.69 ? expBarComponent68
          : 0.69 <= exp/maxExp && exp/maxExp < 0.7 ? expBarComponent69
          : 0.7 <= exp/maxExp && exp/maxExp < 0.71 ? expBarComponent70
          : 0.71 <= exp/maxExp && exp/maxExp < 0.72 ? expBarComponent71
          : 0.72 <= exp/maxExp && exp/maxExp < 0.73 ? expBarComponent72
          : 0.73 <= exp/maxExp && exp/maxExp < 0.74 ? expBarComponent73
          : 0.74 <= exp/maxExp && exp/maxExp < 0.75 ? expBarComponent74
          : 0.75 <= exp/maxExp && exp/maxExp < 0.76 ? expBarComponent75
          : 0.76 <= exp/maxExp && exp/maxExp < 0.77 ? expBarComponent76
          : 0.77 <= exp/maxExp && exp/maxExp < 0.78 ? expBarComponent77
          : 0.78 <= exp/maxExp && exp/maxExp < 0.79 ? expBarComponent78
          : 0.79 <= exp/maxExp && exp/maxExp < 0.8 ? expBarComponent79
          : 0.8 <= exp/maxExp && exp/maxExp < 0.81 ? expBarComponent80
          : 0.81 <= exp/maxExp && exp/maxExp < 0.82 ? expBarComponent81
          : 0.82 <= exp/maxExp && exp/maxExp < 0.83 ? expBarComponent82
          : 0.83 <= exp/maxExp && exp/maxExp < 0.84 ? expBarComponent83
          : 0.84 <= exp/maxExp && exp/maxExp < 0.85 ? expBarComponent84
          : 0.85 <= exp/maxExp && exp/maxExp < 0.86 ? expBarComponent85
          : 0.86 <= exp/maxExp && exp/maxExp < 0.87 ? expBarComponent86
          : 0.87 <= exp/maxExp && exp/maxExp < 0.88 ? expBarComponent87
          : 0.88 <= exp/maxExp && exp/maxExp < 0.89 ? expBarComponent88
          : 0.89 <= exp/maxExp && exp/maxExp < 0.9 ? expBarComponent89
          : 0.9 <= exp/maxExp && exp/maxExp < 0.91 ? expBarComponent90
          : 0.91 <= exp/maxExp && exp/maxExp < 0.92 ? expBarComponent91
          : 0.92 <= exp/maxExp && exp/maxExp < 0.93 ? expBarComponent92
          : 0.93 <= exp/maxExp && exp/maxExp < 0.94 ? expBarComponent93
          : 0.94 <= exp/maxExp && exp/maxExp < 0.95 ? expBarComponent94
          : 0.95 <= exp/maxExp && exp/maxExp < 0.96 ? expBarComponent95
          : 0.96 <= exp/maxExp && exp/maxExp < 0.97 ? expBarComponent96
          : 0.97 <= exp/maxExp && exp/maxExp < 0.98 ? expBarComponent97
          : 0.98 <= exp/maxExp && exp/maxExp < 0.99 ? expBarComponent98
          : 0.99 <= exp/maxExp && exp/maxExp < 1 ? expBarComponent99
          : null
         } alt="Experience Bar" className="absolute" />
        </div>
        <div className="absolute top-0 left-0 w-full h-full flex items-left justify-left"
        style={{
          position: 'absolute',
          transform: 'scale(1.4)',
          top: '20%',
          left: '20%',
          right: '80%',
          bottom: '80%',
          marginLeft: '0px',
          marginTop: '0px',
          bottom: '100%',
          display: 'flex',
          alignItems: 'flex-start',
        }}>
          <img src={vaporeonPortraitNormal} alt="Vaporeon Portrait" className="w-16 h-16" />
      </div>
      </div>
    {isPaused && !showOptions && !showMoves && !showToolbox && !showStatus && (
      <div className="menu">
        <h2 className="text-white text-lg">Paused</h2>
        <div className="flex">
          <button className="bg-blue-500 text-white p-2 rounded mr-2" onClick={() => setShowStatus(true)}>Status</button>
          <button className="bg-blue-500 text-white p-2 rounded" onClick={() => setShowMoves(true)}>Moves</button>
          <button className="bg-blue-500 text-white p-2 rounded" onClick={() => setShowToolbox(true)}>Toolbox</button>
          <button className="bg-blue-500 text-white p-2 rounded" onClick={() => setShowOptions(true)}>Options</button>
          <button className="bg-red-500 text-white p-2 rounded" onClick={() => setIsPaused(false)}>Close</button>
        </div>
      </div>
    )}
    {isPaused && showStatus && ( // Show status menu when Status is clicked
      <div className="menu status-menu">
        <h2 className="text-white text-lg">Status</h2>
        <p className="text-white">Level: {level}</p>
        <p className="text-white">HP: {playerHP}/{maxPlayerHP}</p>
        <p className="text-white">EXP: {exp}/{maxExp}</p>
        <p className="text-white">Attack: {playerAttack}</p>
        <p className="text-white">Special Attack: {playerSpecialAttack}</p>
        <p className="text-white">Speed: {playerSpeed}</p>
        <p className="text-white">Special Defense: {playerSpecialDefense}</p>
        <p className="text-white">Defense: {playerDefense}</p>
        <button className="bg-blue-500 text-white p-2 rounded" onClick={() => setShowStatus(false)}>Back</button>
      </div>
    )}
    {isPaused && showOptions && ( // Show options menu when options are clicked
      <div className="menu options-menu">
        <h2 className="text-white text-lg">Options</h2>
        <label>
          <input type="checkbox" checked={checkBox1} onChange={() => setCheckBox1(!checkBox1)} /> Checkbox 1
        </label>
        <label>
          <input type="checkbox" checked={checkBox2} onChange={() => setCheckBox2(!checkBox2)} /> Checkbox 2
        </label>
        <label>
          <input type="checkbox" checked={checkBox3} onChange={() => setCheckBox3(!checkBox3)} /> Checkbox 3
        </label>
        <button className="bg-blue-500 text-white p-2 rounded" onClick={() => setShowOptions(false)}>Back</button>
      </div>
    )}
    {isPaused && showMoves && ( // Show moves menu when Moves is clicked
      <div className="menu moves-menu">
        <h2 className="text-white text-lg">Moves</h2>
        <p className="text-white">Water Pulse - {MOVE_DEFS["Water Pulse"].ppcurr}/{MOVE_DEFS["Water Pulse"].ppmax} PP</p>
        <p className="text-white">Aqua Tail - {MOVE_DEFS["Aqua Tail"].ppcurr}/{MOVE_DEFS["Aqua Tail"].ppmax} PP</p>
        <p className="text-white">Acid Armor - {MOVE_DEFS["Acid Armor"].ppcurr}/{MOVE_DEFS["Acid Armor"].ppmax} PP</p>
        <p className="text-white">Refresh - {MOVE_DEFS["Refresh"].ppcurr}/{MOVE_DEFS["Refresh"].ppmax} PP</p>
        <button className="bg-blue-500 text-white p-2 rounded" onClick={() => setShowMoves(false)}>Back</button>
      </div>
    )}
    {isPaused && showToolbox && (
      <div className="menu"
      style={{
        margin: '10px',
        borderColor: 'blue',
        borderWidth: '4px',
        borderStyle: 'solid',
        backgroundColor: 'rgba(0, 0, 50, 0.8)',
        display: 'grid',
        gridTemplateRows: 'auto minmax(0, 1fr)',
        minHeight: '50vh',
        minWidth: '50vh',
        opacity: '1',
        zIndex: '100'
      }}>
        <h2 className="text-white text-lg">Toolbox</h2>
        {inventory.length === 0 ? (
          <p className="text-white">No items in inventory.</p>
        ) : (
          <div>
            <ul>
              {inventory.map((item, idx) => (
                <li key={idx} className="text-white flex items-center mb-2">
                  <img src={item.sprite} alt={item.name} style={{ width: 32, marginRight: 8 }} />
                  {item.name} x{item.count}
                </li>
              ))}
            </ul>
            {/* Mini-menu for item actions */}
            {showItemActionMenu && itemSelected !== null && (
              <div style={{
                position: 'absolute',
                left: '70%',
                top: `${40 * (itemOrder - 1) + 60}px`,
                background: 'rgba(0,0,50,0.95)',
                border: '2px solid white',
                borderRadius: '8px',
                padding: '10px',
                zIndex: 200
              }}>
                <ul style={{margin: 0, padding: 0, listStyle: 'none'}}>
                  {itemActions.map((action, idx) => (
                    <li key={action} style={{
                      color: idx === itemActionIndex ? 'yellow' : 'white',
                      fontWeight: idx === itemActionIndex ? 'bold' : 'normal',
                      marginBottom: '6px',
                      fontSize: '18px',
                    }}>
                      {action}
                    </li>
                  ))}
                </ul>
              </div>
            )}
          </div>
        )}
        <div className="menu-itemSelector">
          <img src={itemSelector} alt="Item Selector" style={{ 
            width: 64, 
            height: 64,
            marginLeft: '55%',
            animation: 'flicker 1s infinite',
            transform: itemOrder <= 1 ? `none` : `translateY(${(itemOrder - 1) * 40}px)`,
            opacity: showItemActionMenu ? 1 : itemSelected !== null && flickerFrame !== 0 ? 1 : 0,
            zIndex: itemSelected !== null ? 101 : 'auto',
            position: 'fixed',
            top: '35px'
          }} />
        </div>
        <button className="bg-blue-500 text-white p-2 rounded" onClick={() => setShowToolbox(false)}>Back</button>
      </div>
    )}
    {projectiles.map(p => (
  <img
    key={p.id}
    src={p.sprite}
    alt="thrown"
    style={{
      position: 'absolute',
      left: `${p.x * 40}px`,    // 40px tile size used elsewhere
      top: `${p.y * 40}px`,
      width: '40px',
      height: '40px',
      transformOrigin: 'center',
      zIndex: 40,
      pointerEvents: 'none',
      objectFit: 'contain'
    }}
  />
))}
  </div>
);
}
const MemoizedGame = React.memo(Game);

// Render the memoized component
ReactDOM.render(
  <MemoizedGame />, // Use the memoized component as a JSX element
  document.getElementById('root')
  );
</script>
</body>
</html>
